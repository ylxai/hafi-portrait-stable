/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/events/[id]/route";
exports.ids = ["app/api/events/[id]/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "sharp":
/*!************************!*\
  !*** external "sharp" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("sharp");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "?32c4":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?66e9":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fevents%2F%5Bid%5D%2Froute&page=%2Fapi%2Fevents%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fevents%2F%5Bid%5D%2Froute.ts&appDir=C%3A%5CUsers%5CAdministrator%5Cnana-cursor-admin-dashboard-gallery-feature-enhancement-a647%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAdministrator%5Cnana-cursor-admin-dashboard-gallery-feature-enhancement-a647&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fevents%2F%5Bid%5D%2Froute&page=%2Fapi%2Fevents%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fevents%2F%5Bid%5D%2Froute.ts&appDir=C%3A%5CUsers%5CAdministrator%5Cnana-cursor-admin-dashboard-gallery-feature-enhancement-a647%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAdministrator%5Cnana-cursor-admin-dashboard-gallery-feature-enhancement-a647&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_Administrator_nana_cursor_admin_dashboard_gallery_feature_enhancement_a647_src_app_api_events_id_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/events/[id]/route.ts */ \"(rsc)/./src/app/api/events/[id]/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/events/[id]/route\",\n        pathname: \"/api/events/[id]\",\n        filename: \"route\",\n        bundlePath: \"app/api/events/[id]/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\Administrator\\\\nana-cursor-admin-dashboard-gallery-feature-enhancement-a647\\\\src\\\\app\\\\api\\\\events\\\\[id]\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_Administrator_nana_cursor_admin_dashboard_gallery_feature_enhancement_a647_src_app_api_events_id_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/events/[id]/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZldmVudHMlMkYlNUJpZCU1RCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGZXZlbnRzJTJGJTVCaWQlNUQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZldmVudHMlMkYlNUJpZCU1RCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNBZG1pbmlzdHJhdG9yJTVDbmFuYS1jdXJzb3ItYWRtaW4tZGFzaGJvYXJkLWdhbGxlcnktZmVhdHVyZS1lbmhhbmNlbWVudC1hNjQ3JTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNBZG1pbmlzdHJhdG9yJTVDbmFuYS1jdXJzb3ItYWRtaW4tZGFzaGJvYXJkLWdhbGxlcnktZmVhdHVyZS1lbmhhbmNlbWVudC1hNjQ3JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzZFO0FBQzFKO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdUdBQXVHO0FBQy9HO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDNko7O0FBRTdKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGFmaXBvcnRyYWl0LW5leHRqcy8/NWQ5YiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxBZG1pbmlzdHJhdG9yXFxcXG5hbmEtY3Vyc29yLWFkbWluLWRhc2hib2FyZC1nYWxsZXJ5LWZlYXR1cmUtZW5oYW5jZW1lbnQtYTY0N1xcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxldmVudHNcXFxcW2lkXVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZXZlbnRzL1tpZF0vcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9ldmVudHMvW2lkXVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvZXZlbnRzL1tpZF0vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxBZG1pbmlzdHJhdG9yXFxcXG5hbmEtY3Vyc29yLWFkbWluLWRhc2hib2FyZC1nYWxsZXJ5LWZlYXR1cmUtZW5oYW5jZW1lbnQtYTY0N1xcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxldmVudHNcXFxcW2lkXVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9ldmVudHMvW2lkXS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fevents%2F%5Bid%5D%2Froute&page=%2Fapi%2Fevents%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fevents%2F%5Bid%5D%2Froute.ts&appDir=C%3A%5CUsers%5CAdministrator%5Cnana-cursor-admin-dashboard-gallery-feature-enhancement-a647%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAdministrator%5Cnana-cursor-admin-dashboard-gallery-feature-enhancement-a647&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/events/[id]/route.ts":
/*!******************************************!*\
  !*** ./src/app/api/events/[id]/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   PUT: () => (/* binding */ PUT)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/database */ \"(rsc)/./src/lib/database.ts\");\n\n // Mengimpor database langsung\nasync function GET(request, { params }) {\n    const eventId = params.id;\n    if (!eventId) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Event ID is required\"\n        }, {\n            status: 400\n        });\n    }\n    try {\n        const event = await _lib_database__WEBPACK_IMPORTED_MODULE_1__.database.getEventById(eventId); // Menggunakan database langsung\n        if (!event) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Event not found\"\n            }, {\n                status: 404\n            });\n        }\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json(event);\n    } catch (error) {\n        console.error(\"Get event error:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to fetch event\",\n            details: error.message\n        }, {\n            status: 500\n        });\n    }\n}\nasync function PUT(request, { params }) {\n    try {\n        const eventId = params.id;\n        const body = await request.json();\n        const updatedEvent = await _lib_database__WEBPACK_IMPORTED_MODULE_1__.database.updateEvent(eventId, {\n            name: body.name,\n            date: body.date,\n            access_code: body.accessCode || body.access_code,\n            is_premium: body.isPremium || body.is_premium\n        });\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json(updatedEvent);\n    } catch (error) {\n        console.error(\"Update event error:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            message: \"Failed to update event\",\n            error: error.message\n        }, {\n            status: 400\n        });\n    }\n}\nasync function DELETE(request, { params }) {\n    try {\n        const eventId = params.id;\n        await _lib_database__WEBPACK_IMPORTED_MODULE_1__.database.deleteEvent(eventId); // Menggunakan database langsung\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            message: \"Event deleted successfully\"\n        });\n    } catch (error) {\n        console.error(\"Delete event error:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            message: \"Failed to delete event\",\n            error: error.message\n        }, {\n            status: 400\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9ldmVudHMvW2lkXS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUF3RDtBQUNkLENBQUMsOEJBQThCO0FBRWxFLGVBQWVFLElBQ3BCQyxPQUFvQixFQUNwQixFQUFFQyxNQUFNLEVBQThCO0lBRXRDLE1BQU1DLFVBQVVELE9BQU9FLEVBQUU7SUFFekIsSUFBSSxDQUFDRCxTQUFTO1FBQ1osT0FBT0wsa0ZBQVlBLENBQUNPLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXVCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQzVFO0lBRUEsSUFBSTtRQUNGLE1BQU1DLFFBQVEsTUFBTVQsbURBQVFBLENBQUNVLFlBQVksQ0FBQ04sVUFBVSxnQ0FBZ0M7UUFFcEYsSUFBSSxDQUFDSyxPQUFPO1lBQ1YsT0FBT1Ysa0ZBQVlBLENBQUNPLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFrQixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDdkU7UUFFQSxPQUFPVCxrRkFBWUEsQ0FBQ08sSUFBSSxDQUFDRztJQUMzQixFQUFFLE9BQU9GLE9BQVk7UUFDbkJJLFFBQVFKLEtBQUssQ0FBQyxvQkFBb0JBO1FBQ2xDLE9BQU9SLGtGQUFZQSxDQUFDTyxJQUFJLENBQ3RCO1lBQUVDLE9BQU87WUFBeUJLLFNBQVNMLE1BQU1NLE9BQU87UUFBQyxHQUN6RDtZQUFFTCxRQUFRO1FBQUk7SUFFbEI7QUFDRjtBQUVPLGVBQWVNLElBQ3BCWixPQUFvQixFQUNwQixFQUFFQyxNQUFNLEVBQThCO0lBRXRDLElBQUk7UUFDRixNQUFNQyxVQUFVRCxPQUFPRSxFQUFFO1FBQ3pCLE1BQU1VLE9BQU8sTUFBTWIsUUFBUUksSUFBSTtRQUUvQixNQUFNVSxlQUFlLE1BQU1oQixtREFBUUEsQ0FBQ2lCLFdBQVcsQ0FBQ2IsU0FBUztZQUN2RGMsTUFBTUgsS0FBS0csSUFBSTtZQUNmQyxNQUFNSixLQUFLSSxJQUFJO1lBQ2ZDLGFBQWFMLEtBQUtNLFVBQVUsSUFBSU4sS0FBS0ssV0FBVztZQUNoREUsWUFBWVAsS0FBS1EsU0FBUyxJQUFJUixLQUFLTyxVQUFVO1FBQy9DO1FBRUEsT0FBT3ZCLGtGQUFZQSxDQUFDTyxJQUFJLENBQUNVO0lBQzNCLEVBQUUsT0FBT1QsT0FBWTtRQUNuQkksUUFBUUosS0FBSyxDQUFDLHVCQUF1QkE7UUFDckMsT0FBT1Isa0ZBQVlBLENBQUNPLElBQUksQ0FDdEI7WUFBRU8sU0FBUztZQUEwQk4sT0FBT0EsTUFBTU0sT0FBTztRQUFDLEdBQzFEO1lBQUVMLFFBQVE7UUFBSTtJQUVsQjtBQUNGO0FBRU8sZUFBZWdCLE9BQ3BCdEIsT0FBb0IsRUFDcEIsRUFBRUMsTUFBTSxFQUE4QjtJQUV0QyxJQUFJO1FBQ0YsTUFBTUMsVUFBVUQsT0FBT0UsRUFBRTtRQUV6QixNQUFNTCxtREFBUUEsQ0FBQ3lCLFdBQVcsQ0FBQ3JCLFVBQVUsZ0NBQWdDO1FBRXJFLE9BQU9MLGtGQUFZQSxDQUFDTyxJQUFJLENBQUM7WUFBRU8sU0FBUztRQUE2QjtJQUNuRSxFQUFFLE9BQU9OLE9BQVk7UUFDbkJJLFFBQVFKLEtBQUssQ0FBQyx1QkFBdUJBO1FBQ3JDLE9BQU9SLGtGQUFZQSxDQUFDTyxJQUFJLENBQ3RCO1lBQUVPLFNBQVM7WUFBMEJOLE9BQU9BLE1BQU1NLE9BQU87UUFBQyxHQUMxRDtZQUFFTCxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2hhZmlwb3J0cmFpdC1uZXh0anMvLi9zcmMvYXBwL2FwaS9ldmVudHMvW2lkXS9yb3V0ZS50cz9mZTQ4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGRhdGFiYXNlIH0gZnJvbSAnQC9saWIvZGF0YWJhc2UnOyAvLyBNZW5naW1wb3IgZGF0YWJhc2UgbGFuZ3N1bmdcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoXHJcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXHJcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgaWQ6IHN0cmluZyB9IH1cclxuKSB7XHJcbiAgY29uc3QgZXZlbnRJZCA9IHBhcmFtcy5pZDtcclxuXHJcbiAgaWYgKCFldmVudElkKSB7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJFdmVudCBJRCBpcyByZXF1aXJlZFwiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgZXZlbnQgPSBhd2FpdCBkYXRhYmFzZS5nZXRFdmVudEJ5SWQoZXZlbnRJZCk7IC8vIE1lbmdndW5ha2FuIGRhdGFiYXNlIGxhbmdzdW5nXHJcblxyXG4gICAgaWYgKCFldmVudCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJFdmVudCBub3QgZm91bmRcIiB9LCB7IHN0YXR1czogNDA0IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihldmVudCk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkdldCBldmVudCBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBldmVudFwiLCBkZXRhaWxzOiBlcnJvci5tZXNzYWdlIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQVVQoXHJcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXHJcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgaWQ6IHN0cmluZyB9IH1cclxuKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGV2ZW50SWQgPSBwYXJhbXMuaWQ7XHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICBcclxuICAgIGNvbnN0IHVwZGF0ZWRFdmVudCA9IGF3YWl0IGRhdGFiYXNlLnVwZGF0ZUV2ZW50KGV2ZW50SWQsIHsgLy8gTWVuZ2d1bmFrYW4gZGF0YWJhc2UgbGFuZ3N1bmdcclxuICAgICAgbmFtZTogYm9keS5uYW1lLFxyXG4gICAgICBkYXRlOiBib2R5LmRhdGUsXHJcbiAgICAgIGFjY2Vzc19jb2RlOiBib2R5LmFjY2Vzc0NvZGUgfHwgYm9keS5hY2Nlc3NfY29kZSxcclxuICAgICAgaXNfcHJlbWl1bTogYm9keS5pc1ByZW1pdW0gfHwgYm9keS5pc19wcmVtaXVtLFxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih1cGRhdGVkRXZlbnQpO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1VwZGF0ZSBldmVudCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgbWVzc2FnZTogXCJGYWlsZWQgdG8gdXBkYXRlIGV2ZW50XCIsIGVycm9yOiBlcnJvci5tZXNzYWdlIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUoXHJcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXHJcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgaWQ6IHN0cmluZyB9IH1cclxuKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGV2ZW50SWQgPSBwYXJhbXMuaWQ7XHJcbiAgICBcclxuICAgIGF3YWl0IGRhdGFiYXNlLmRlbGV0ZUV2ZW50KGV2ZW50SWQpOyAvLyBNZW5nZ3VuYWthbiBkYXRhYmFzZSBsYW5nc3VuZ1xyXG4gICAgXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBtZXNzYWdlOiBcIkV2ZW50IGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5XCIgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcignRGVsZXRlIGV2ZW50IGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBtZXNzYWdlOiBcIkZhaWxlZCB0byBkZWxldGUgZXZlbnRcIiwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSxcclxuICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufSAiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZGF0YWJhc2UiLCJHRVQiLCJyZXF1ZXN0IiwicGFyYW1zIiwiZXZlbnRJZCIsImlkIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiZXZlbnQiLCJnZXRFdmVudEJ5SWQiLCJjb25zb2xlIiwiZGV0YWlscyIsIm1lc3NhZ2UiLCJQVVQiLCJib2R5IiwidXBkYXRlZEV2ZW50IiwidXBkYXRlRXZlbnQiLCJuYW1lIiwiZGF0ZSIsImFjY2Vzc19jb2RlIiwiYWNjZXNzQ29kZSIsImlzX3ByZW1pdW0iLCJpc1ByZW1pdW0iLCJERUxFVEUiLCJkZWxldGVFdmVudCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/events/[id]/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/database.ts":
/*!*****************************!*\
  !*** ./src/lib/database.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   database: () => (/* binding */ database)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(rsc)/./src/lib/supabase.ts\");\n/* harmony import */ var _image_optimizer_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./image-optimizer-server */ \"(rsc)/./src/lib/image-optimizer-server.ts\");\n // Pastikan ini diimpor dengan benar\n\nclass DatabaseService {\n    constructor(){\n        this.supabase = _supabase__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin;\n        this.imageOptimizer = new _image_optimizer_server__WEBPACK_IMPORTED_MODULE_1__.ImageOptimizerServer(this.supabase, \"photos\");\n    }\n    // --- Metode Event ---\n    async getAllEvents() {\n        const { data, error } = await this.supabase.from(\"events\").select(\"*\").order(\"date\", {\n            ascending: false\n        });\n        if (error) throw error;\n        return data;\n    }\n    async getPublicEvents() {\n        const { data, error } = await this.supabase.from(\"events\").select(\"id, name, date, is_premium, qr_code, shareable_link\").is(\"is_premium\", false) // Asumsi hanya event non-premium yang publik, sesuaikan jika perlu\n        .order(\"date\", {\n            ascending: false\n        });\n        if (error) throw error;\n        return data;\n    }\n    async getEventById(id) {\n        const { data, error } = await this.supabase.from(\"events\").select(\"*\").eq(\"id\", id).single();\n        if (error) throw error;\n        return data;\n    }\n    async createEvent(event) {\n        // First, insert the event to get the ID\n        const { data: newEvent, error } = await this.supabase.from(\"events\").insert(event).select().single();\n        if (error) throw error;\n        try {\n            // Generate QR code and shareable link\n            const baseUrl = \"http://localhost:3000\" || 0;\n            const eventUrl = `${baseUrl}/event/${newEvent.id}?code=${newEvent.access_code}`;\n            // Generate QR code using a service like QRServer.com\n            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(eventUrl)}`;\n            // Update the event with QR code and shareable link\n            const { data: updatedEvent, error: updateError } = await this.supabase.from(\"events\").update({\n                qr_code: qrCodeUrl,\n                shareable_link: eventUrl\n            }).eq(\"id\", newEvent.id).select().single();\n            if (updateError) throw updateError;\n            return updatedEvent;\n        } catch (updateError) {\n            console.error(\"Error generating QR code:\", updateError);\n            // Return the event even if QR code generation fails\n            return newEvent;\n        }\n    }\n    async updateEvent(id, updates) {\n        const { data, error } = await this.supabase.from(\"events\").update(updates).eq(\"id\", id).select().single();\n        if (error) throw error;\n        return data;\n    }\n    async deleteEvent(id) {\n        const { error } = await this.supabase.from(\"events\").delete().eq(\"id\", id);\n        if (error) throw error;\n    }\n    async verifyEventAccessCode(eventId, code) {\n        const { data, error } = await this.supabase.from(\"events\").select(\"id\").eq(\"id\", eventId).eq(\"access_code\", code).single();\n        if (error) {\n            if (true) {\n                console.error(\"Error verifying access code:\", error);\n            }\n            return false;\n        }\n        return !!data;\n    }\n    // --- Metode Foto ---\n    async getEventPhotos(eventId) {\n        const { data, error } = await this.supabase.from(\"photos\").select(\"*\").eq(\"event_id\", eventId).order(\"uploaded_at\", {\n            ascending: false\n        });\n        if (error) throw error;\n        return data;\n    }\n    async getHomepagePhotos() {\n        const { data, error } = await this.supabase.from(\"photos\").select(\"*\").eq(\"is_homepage\", true) // Asumsi kolom ini ada di tabel photos\n        .order(\"uploaded_at\", {\n            ascending: false\n        });\n        if (error) {\n            // Log error yang lebih spesifik jika kolom tidak ditemukan\n            if (error.code === \"42P01\") {\n                if (true) {\n                    console.error(\"Database Error: Column 'is_homepage' does not exist. Please add it to your 'photos' table.\");\n                }\n            }\n            throw error;\n        }\n        return data;\n    }\n    validateFileExtension(filename) {\n        const allowedExtensions = [\n            \"jpg\",\n            \"jpeg\",\n            \"png\",\n            \"gif\",\n            \"webp\"\n        ];\n        const ext = filename.split(\".\").pop()?.toLowerCase();\n        return ext ? allowedExtensions.includes(ext) : false;\n    }\n    generateFileName(originalName) {\n        const fileExt = originalName.split(\".\").pop()?.toLowerCase() || \"jpg\";\n        const timestamp = Date.now();\n        const randomStr = Math.random().toString(36).substring(2, 8);\n        return `${timestamp}_${randomStr}.${fileExt}`;\n    }\n    async getEvents() {\n        const { data, error } = await this.supabase.from(\"events\").select(\"*\").order(\"date\", {\n            ascending: false\n        });\n        if (error) throw error;\n        return data || [];\n    }\n    async getSimpleCompressionAnalytics() {\n        try {\n            // Get photos with compression data (simplified version)\n            const { data: photos, error: photosError } = await this.supabase.from(\"photos\").select(\"*\").not(\"optimized_images\", \"is\", null).order(\"uploaded_at\", {\n                ascending: false\n            }).limit(100); // Limit to recent 100 photos\n            if (photosError) throw photosError;\n            // Calculate simple analytics\n            const totalPhotos = photos?.length || 0;\n            let totalOriginalSize = 0;\n            let totalOptimizedSize = 0;\n            let totalSavingsBytes = 0;\n            const recentPhotos = [];\n            photos?.forEach((photo)=>{\n                if (photo.image_metadata && photo.optimized_images) {\n                    const originalSize = photo.image_metadata.original_size || 0;\n                    const optimizedSize = photo.optimized_images.medium?.size || 0;\n                    const savings = originalSize - optimizedSize;\n                    const savingsPercentage = originalSize > 0 ? savings / originalSize * 100 : 0;\n                    totalOriginalSize += originalSize;\n                    totalOptimizedSize += optimizedSize;\n                    totalSavingsBytes += savings;\n                    // Recent photos (top 10)\n                    if (recentPhotos.length < 10) {\n                        recentPhotos.push({\n                            id: photo.id,\n                            original_name: photo.original_name,\n                            original_size: originalSize,\n                            optimized_size: optimizedSize,\n                            savings_percentage: savingsPercentage,\n                            uploaded_at: photo.uploaded_at\n                        });\n                    }\n                }\n            });\n            const totalSavingsPercentage = totalOriginalSize > 0 ? totalSavingsBytes / totalOriginalSize * 100 : 0;\n            const averageCompressionRatio = totalOptimizedSize > 0 ? totalOriginalSize / totalOptimizedSize : 1;\n            return {\n                totalPhotos,\n                totalOriginalSize,\n                totalOptimizedSize,\n                totalSavingsBytes,\n                totalSavingsPercentage,\n                storageSaved: this.formatFileSize(totalSavingsBytes),\n                averageCompressionRatio,\n                recentPhotos: recentPhotos.sort((a, b)=>b.savings_percentage - a.savings_percentage)\n            };\n        } catch (error) {\n            console.error(\"Error getting simple compression analytics:\", error);\n            throw error;\n        }\n    }\n    formatFileSize(bytes) {\n        if (bytes === 0) return \"0 Bytes\";\n        const k = 1024;\n        const sizes = [\n            \"Bytes\",\n            \"KB\",\n            \"MB\",\n            \"GB\"\n        ];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n    }\n    async validateEventAccess(eventId) {\n        const { data, error } = await this.supabase.from(\"events\").select(\"id, is_premium\").eq(\"id\", eventId).single();\n        if (error || !data) {\n            throw new Error(\"Event not found\");\n        }\n        return true;\n    }\n    async uploadEventPhoto(eventId, file, uploaderName = \"Anonymous\", albumName = \"Tamu\") {\n        // Validate eventId exists\n        await this.validateEventAccess(eventId);\n        // Validate file extension\n        if (!this.validateFileExtension(file.name)) {\n            throw new Error(\"Invalid file type. Allowed: jpg, jpeg, png, gif, webp\");\n        }\n        try {\n            // Convert File to Buffer for server-side processing\n            const arrayBuffer = await file.arrayBuffer();\n            const buffer = Buffer.from(arrayBuffer);\n            // Process image with optimization (server-side)\n            const optimizedImages = await this.imageOptimizer.processImage(buffer, file.name, `events/${eventId}`);\n            // Get image metadata\n            const sharp = (await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! sharp */ \"sharp\", 23))).default;\n            const metadata = await sharp(buffer).metadata();\n            const imageMetadata = {\n                width: metadata.width || 0,\n                height: metadata.height || 0,\n                format: metadata.format || \"jpeg\",\n                original_size: buffer.length\n            };\n            // Calculate compression stats\n            const compressionStats = _image_optimizer_server__WEBPACK_IMPORTED_MODULE_1__.ImageOptimizerServer.getCompressionStats(optimizedImages);\n            const { data: photoData, error: insertError } = await this.supabase.from(\"photos\").insert({\n                event_id: eventId,\n                url: optimizedImages.original.url,\n                thumbnail_url: optimizedImages.thumbnail.url,\n                original_name: file.name,\n                uploader_name: uploaderName,\n                album_name: albumName,\n                is_homepage: false,\n                filename: this.generateFileName(file.name),\n                optimized_images: optimizedImages,\n                image_metadata: imageMetadata,\n                compression_stats: compressionStats\n            }).select().single();\n            if (insertError) throw insertError;\n            return photoData;\n        } catch (error) {\n            console.error(\"Error uploading optimized event photo:\", error);\n            throw error;\n        }\n    }\n    async uploadHomepagePhoto(file) {\n        // Validate file extension\n        if (!this.validateFileExtension(file.name)) {\n            throw new Error(\"Invalid file type. Allowed: jpg, jpeg, png, gif, webp\");\n        }\n        try {\n            // Convert File to Buffer for server-side processing\n            const arrayBuffer = await file.arrayBuffer();\n            const buffer = Buffer.from(arrayBuffer);\n            // Process image with optimization (server-side)\n            const optimizedImages = await this.imageOptimizer.processImage(buffer, file.name, \"homepage\");\n            // Get image metadata\n            const sharp = (await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! sharp */ \"sharp\", 23))).default;\n            const metadata = await sharp(buffer).metadata();\n            const imageMetadata = {\n                width: metadata.width || 0,\n                height: metadata.height || 0,\n                format: metadata.format || \"jpeg\",\n                original_size: buffer.length\n            };\n            // Calculate compression stats\n            const compressionStats = _image_optimizer_server__WEBPACK_IMPORTED_MODULE_1__.ImageOptimizerServer.getCompressionStats(optimizedImages);\n            const { data: photoData, error: insertError } = await this.supabase.from(\"photos\").insert({\n                url: optimizedImages.original.url,\n                thumbnail_url: optimizedImages.thumbnail.url,\n                original_name: file.name,\n                is_homepage: true,\n                event_id: null,\n                uploader_name: \"Admin\",\n                album_name: \"Homepage\",\n                filename: this.generateFileName(file.name),\n                optimized_images: optimizedImages,\n                image_metadata: imageMetadata,\n                compression_stats: compressionStats\n            }).select().single();\n            if (insertError) throw insertError;\n            return photoData;\n        } catch (error) {\n            console.error(\"Error uploading optimized homepage photo:\", error);\n            throw error;\n        }\n    }\n    async getPhotoById(photoId) {\n        const { data, error } = await this.supabase.from(\"photos\").select(\"*\").eq(\"id\", photoId).single();\n        if (error) throw error;\n        return data;\n    }\n    async deletePhoto(photoId) {\n        // Get photo details\n        const photo = await this.getPhotoById(photoId);\n        if (!photo) {\n            throw new Error(\"Photo not found\");\n        }\n        try {\n            // Extract file path from URL or use stored filename\n            let filePath;\n            if (photo.filename) {\n                // Use stored filename if available\n                if (photo.is_homepage) {\n                    filePath = `homepage/${photo.filename}`;\n                } else if (photo.event_id) {\n                    filePath = `events/${photo.event_id}/${photo.filename}`;\n                } else {\n                    // Fallback if structure is unclear\n                    filePath = photo.filename;\n                }\n            } else {\n                // Extract from URL as fallback\n                const urlParts = photo.url.split(\"/\");\n                const fileName = urlParts[urlParts.length - 1];\n                if (photo.is_homepage) {\n                    filePath = `homepage/${fileName}`;\n                } else if (photo.event_id) {\n                    filePath = `events/${photo.event_id}/${fileName}`;\n                } else {\n                    // Fallback if structure is unclear\n                    filePath = fileName;\n                }\n            }\n            // Delete from storage first\n            const { error: deleteStorageError } = await this.supabase.storage.from(\"photos\").remove([\n                filePath\n            ]);\n            if (deleteStorageError) {\n                if (true) {\n                    console.error(\"Error deleting file from storage:\", deleteStorageError);\n                }\n            // Continue with database deletion even if storage deletion fails\n            }\n            // Then delete from database\n            const { error: deleteDbError } = await this.supabase.from(\"photos\").delete().eq(\"id\", photoId);\n            if (deleteDbError) throw deleteDbError;\n        } catch (error) {\n            // If it's not a storage error, rethrow\n            if (error instanceof Error && !error.message.includes(\"storage\")) {\n                throw error;\n            }\n            // For storage errors, try to delete from database anyway\n            const { error: deleteDbError } = await this.supabase.from(\"photos\").delete().eq(\"id\", photoId);\n            if (deleteDbError) throw deleteDbError;\n        }\n    }\n    async likePhoto(photoId) {\n        const { data, error } = await this.supabase.rpc(\"increment_likes\", {\n            photo_id: photoId\n        }); // Panggil fungsi RPC\n        if (error) throw error;\n    }\n    // --- Metode Pesan ---\n    async getEventMessages(eventId) {\n        const { data, error } = await this.supabase.from(\"messages\").select(\"*\").eq(\"event_id\", eventId).order(\"sent_at\", {\n            ascending: false\n        });\n        if (error) throw error;\n        return data;\n    }\n    async createMessage(message) {\n        const { data, error } = await this.supabase.from(\"messages\").insert(message).select().single();\n        if (error) throw error;\n        return data;\n    }\n    async heartMessage(messageId) {\n        const { data, error } = await this.supabase.rpc(\"increment_hearts\", {\n            message_id: messageId\n        }); // Panggil fungsi RPC\n        if (error) throw error;\n    }\n    // --- Metode Statistik ---\n    async getStats() {\n        const { count: totalEvents, error: eventsError } = await this.supabase.from(\"events\").select(\"*\", {\n            count: \"exact\",\n            head: true\n        });\n        if (eventsError) throw eventsError;\n        const { count: totalPhotos, error: photosError } = await this.supabase.from(\"photos\").select(\"*\", {\n            count: \"exact\",\n            head: true\n        });\n        if (photosError) throw photosError;\n        const { count: totalMessages, error: messagesError } = await this.supabase.from(\"messages\").select(\"*\", {\n            count: \"exact\",\n            head: true\n        });\n        if (messagesError) throw messagesError;\n        return {\n            totalEvents: totalEvents || 0,\n            totalPhotos: totalPhotos || 0,\n            totalMessages: totalMessages || 0\n        };\n    }\n}\nconst database = new DatabaseService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q2xDO0lBQ0Y7QUFDRjtBQUVPLE1BQU1FLFdBQVcsSUFBSXRLLGtCQUFrQiIsInNvdXJjZXMiOlsid2VicGFjazovL2hhZmlwb3J0cmFpdC1uZXh0anMvLi9zcmMvbGliL2RhdGFiYXNlLnRzP2MxYjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gJy4vc3VwYWJhc2UnOyAvLyBQYXN0aWthbiBpbmkgZGlpbXBvciBkZW5nYW4gYmVuYXJcclxuaW1wb3J0IHsgSW1hZ2VPcHRpbWl6ZXJTZXJ2ZXIgfSBmcm9tICcuL2ltYWdlLW9wdGltaXplci1zZXJ2ZXInO1xyXG5cclxuLy8gRGVmaW5pc2kgVGlwZSBEYXRhIHVudHVrIGtvbnNpc3RlbnNpXHJcbmV4cG9ydCB0eXBlIEV2ZW50ID0ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIGRhdGU6IHN0cmluZztcclxuICBhY2Nlc3NfY29kZTogc3RyaW5nIHwgbnVsbDtcclxuICBpc19wcmVtaXVtOiBib29sZWFuO1xyXG4gIHFyX2NvZGU6IHN0cmluZyB8IG51bGw7XHJcbiAgc2hhcmVhYmxlX2xpbms6IHN0cmluZyB8IG51bGw7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBQaG90byA9IHtcclxuICBpZDogc3RyaW5nO1xyXG4gIGV2ZW50X2lkPzogc3RyaW5nIHwgbnVsbDsgLy8gT3BzaW9uYWwga2FyZW5hIGJpc2EgamFkaSBmb3RvIGhvbWVwYWdlXHJcbiAgdXJsOiBzdHJpbmc7XHJcbiAgdGh1bWJuYWlsX3VybDogc3RyaW5nIHwgbnVsbDtcclxuICB1cGxvYWRlZF9hdDogc3RyaW5nO1xyXG4gIGlzX2hvbWVwYWdlOiBib29sZWFuIHwgbnVsbDsgLy8gVGFtYmFoa2FuIGluaSBqaWthIGJlbHVtIGFkYVxyXG4gIG9yaWdpbmFsX25hbWU6IHN0cmluZztcclxuICB1cGxvYWRlcl9uYW1lPzogc3RyaW5nIHwgbnVsbDtcclxuICBhbGJ1bV9uYW1lPzogc3RyaW5nIHwgbnVsbDtcclxuICBmaWxlbmFtZT86IHN0cmluZyB8IG51bGw7IC8vIFRhbWJhaGthbiBmaWxlbmFtZSBqaWthIHJlcXVpcmVkXHJcbiAgb3B0aW1pemVkX2ltYWdlcz86IE9wdGltaXplZEltYWdlcyB8IG51bGw7XHJcbiAgaW1hZ2VfbWV0YWRhdGE/OiBJbWFnZU1ldGFkYXRhIHwgbnVsbDtcclxuICBjb21wcmVzc2lvbl9zdGF0cz86IENvbXByZXNzaW9uU3RhdHMgfCBudWxsO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgT3B0aW1pemVkSW1hZ2VzID0ge1xyXG4gIG9yaWdpbmFsOiB7IHVybDogc3RyaW5nOyBzaXplOiBudW1iZXI7IHdpZHRoPzogbnVtYmVyOyBoZWlnaHQ/OiBudW1iZXI7IH07XHJcbiAgdGh1bWJuYWlsOiB7IHVybDogc3RyaW5nOyBzaXplOiBudW1iZXI7IH07XHJcbiAgc21hbGw6IHsgdXJsOiBzdHJpbmc7IHNpemU6IG51bWJlcjsgfTtcclxuICBtZWRpdW06IHsgdXJsOiBzdHJpbmc7IHNpemU6IG51bWJlcjsgfTtcclxuICBsYXJnZTogeyB1cmw6IHN0cmluZzsgc2l6ZTogbnVtYmVyOyB9O1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgSW1hZ2VNZXRhZGF0YSA9IHtcclxuICB3aWR0aDogbnVtYmVyO1xyXG4gIGhlaWdodDogbnVtYmVyO1xyXG4gIGZvcm1hdDogc3RyaW5nO1xyXG4gIG9yaWdpbmFsX3NpemU6IG51bWJlcjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIENvbXByZXNzaW9uU3RhdHMgPSB7XHJcbiAgb3JpZ2luYWxfc2l6ZTogc3RyaW5nO1xyXG4gIG9wdGltaXplZF9zaXplOiBzdHJpbmc7XHJcbiAgc2F2aW5nczogbnVtYmVyO1xyXG4gIHJhdGlvOiBzdHJpbmc7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBNZXNzYWdlID0ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgZXZlbnRfaWQ6IHN0cmluZztcclxuICBzZW5kZXJfbmFtZTogc3RyaW5nO1xyXG4gIGNvbnRlbnQ6IHN0cmluZztcclxuICBzZW50X2F0OiBzdHJpbmc7XHJcbiAgaGVhcnRzOiBudW1iZXI7XHJcbiAgZ3Vlc3RfbmFtZT86IHN0cmluZzsgLy8gQWRkIGd1ZXN0X25hbWUgYXMgb3B0aW9uYWwgZm9yIGNvbXBhdGliaWxpdHlcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFN0YXRzID0ge1xyXG4gIHRvdGFsRXZlbnRzOiBudW1iZXI7XHJcbiAgdG90YWxQaG90b3M6IG51bWJlcjtcclxuICB0b3RhbE1lc3NhZ2VzOiBudW1iZXI7XHJcbn07XHJcblxyXG5jbGFzcyBEYXRhYmFzZVNlcnZpY2Uge1xyXG4gIHByaXZhdGUgc3VwYWJhc2U6IHR5cGVvZiBzdXBhYmFzZUFkbWluO1xyXG4gIHByaXZhdGUgaW1hZ2VPcHRpbWl6ZXI6IEltYWdlT3B0aW1pemVyU2VydmVyO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuc3VwYWJhc2UgPSBzdXBhYmFzZUFkbWluO1xyXG4gICAgdGhpcy5pbWFnZU9wdGltaXplciA9IG5ldyBJbWFnZU9wdGltaXplclNlcnZlcih0aGlzLnN1cGFiYXNlLCAncGhvdG9zJyk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gTWV0b2RlIEV2ZW50IC0tLVxyXG4gIGFzeW5jIGdldEFsbEV2ZW50cygpOiBQcm9taXNlPEV2ZW50W10+IHtcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2V2ZW50cycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ2RhdGUnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRQdWJsaWNFdmVudHMoKTogUHJvbWlzZTxFdmVudFtdPiB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdldmVudHMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgbmFtZSwgZGF0ZSwgaXNfcHJlbWl1bSwgcXJfY29kZSwgc2hhcmVhYmxlX2xpbmsnKVxyXG4gICAgICAuaXMoJ2lzX3ByZW1pdW0nLCBmYWxzZSkgLy8gQXN1bXNpIGhhbnlhIGV2ZW50IG5vbi1wcmVtaXVtIHlhbmcgcHVibGlrLCBzZXN1YWlrYW4gamlrYSBwZXJsdVxyXG4gICAgICAub3JkZXIoJ2RhdGUnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRFdmVudEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8RXZlbnQgfCBudWxsPiB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdldmVudHMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdpZCcsIGlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfVxyXG5cclxuICBhc3luYyBjcmVhdGVFdmVudChldmVudDogT21pdDxFdmVudCwgJ2lkJyB8ICdxcl9jb2RlJyB8ICdzaGFyZWFibGVfbGluayc+KTogUHJvbWlzZTxFdmVudD4ge1xyXG4gICAgLy8gRmlyc3QsIGluc2VydCB0aGUgZXZlbnQgdG8gZ2V0IHRoZSBJRFxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdFdmVudCwgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2V2ZW50cycpXHJcbiAgICAgIC5pbnNlcnQoZXZlbnQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEdlbmVyYXRlIFFSIGNvZGUgYW5kIHNoYXJlYWJsZSBsaW5rXHJcbiAgICAgIGNvbnN0IGJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUFBfVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnO1xyXG4gICAgICBjb25zdCBldmVudFVybCA9IGAke2Jhc2VVcmx9L2V2ZW50LyR7bmV3RXZlbnQuaWR9P2NvZGU9JHtuZXdFdmVudC5hY2Nlc3NfY29kZX1gO1xyXG4gICAgICBcclxuICAgICAgLy8gR2VuZXJhdGUgUVIgY29kZSB1c2luZyBhIHNlcnZpY2UgbGlrZSBRUlNlcnZlci5jb21cclxuICAgICAgY29uc3QgcXJDb2RlVXJsID0gYGh0dHBzOi8vYXBpLnFyc2VydmVyLmNvbS92MS9jcmVhdGUtcXItY29kZS8/c2l6ZT0zMDB4MzAwJmRhdGE9JHtlbmNvZGVVUklDb21wb25lbnQoZXZlbnRVcmwpfWA7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVcGRhdGUgdGhlIGV2ZW50IHdpdGggUVIgY29kZSBhbmQgc2hhcmVhYmxlIGxpbmtcclxuICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkRXZlbnQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudHMnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgcXJfY29kZTogcXJDb2RlVXJsLFxyXG4gICAgICAgICAgc2hhcmVhYmxlX2xpbms6IGV2ZW50VXJsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2lkJywgbmV3RXZlbnQuaWQpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICBcclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB0aHJvdyB1cGRhdGVFcnJvcjtcclxuICAgICAgcmV0dXJuIHVwZGF0ZWRFdmVudDtcclxuICAgIH0gY2F0Y2ggKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdlbmVyYXRpbmcgUVIgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIC8vIFJldHVybiB0aGUgZXZlbnQgZXZlbiBpZiBRUiBjb2RlIGdlbmVyYXRpb24gZmFpbHNcclxuICAgICAgcmV0dXJuIG5ld0V2ZW50O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgdXBkYXRlRXZlbnQoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxFdmVudD4pOiBQcm9taXNlPEV2ZW50PiB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdldmVudHMnKVxyXG4gICAgICAudXBkYXRlKHVwZGF0ZXMpXHJcbiAgICAgIC5lcSgnaWQnLCBpZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGRlbGV0ZUV2ZW50KGlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2V2ZW50cycpXHJcbiAgICAgIC5kZWxldGUoKVxyXG4gICAgICAuZXEoJ2lkJywgaWQpO1xyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICB9XHJcblxyXG4gIGFzeW5jIHZlcmlmeUV2ZW50QWNjZXNzQ29kZShldmVudElkOiBzdHJpbmcsIGNvZGU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAuZXEoJ2lkJywgZXZlbnRJZClcclxuICAgICAgLmVxKCdhY2Nlc3NfY29kZScsIGNvZGUpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB2ZXJpZnlpbmcgYWNjZXNzIGNvZGU6JywgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiAhIWRhdGE7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gTWV0b2RlIEZvdG8gLS0tXHJcbiAgYXN5bmMgZ2V0RXZlbnRQaG90b3MoZXZlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxQaG90b1tdPiB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwaG90b3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdldmVudF9pZCcsIGV2ZW50SWQpXHJcbiAgICAgIC5vcmRlcigndXBsb2FkZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRIb21lcGFnZVBob3RvcygpOiBQcm9taXNlPFBob3RvW10+IHtcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Bob3RvcycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAuZXEoJ2lzX2hvbWVwYWdlJywgdHJ1ZSkgLy8gQXN1bXNpIGtvbG9tIGluaSBhZGEgZGkgdGFiZWwgcGhvdG9zXHJcbiAgICAgIC5vcmRlcigndXBsb2FkZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gTG9nIGVycm9yIHlhbmcgbGViaWggc3Blc2lmaWsgamlrYSBrb2xvbSB0aWRhayBkaXRlbXVrYW5cclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICc0MlAwMScpIHsgLy8gUG9zdGdyZVNRTCBlcnJvciBjb2RlIGZvciB1bmRlZmluZWRfdGFibGVcclxuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJEYXRhYmFzZSBFcnJvcjogQ29sdW1uICdpc19ob21lcGFnZScgZG9lcyBub3QgZXhpc3QuIFBsZWFzZSBhZGQgaXQgdG8geW91ciAncGhvdG9zJyB0YWJsZS5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZhbGlkYXRlRmlsZUV4dGVuc2lvbihmaWxlbmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBhbGxvd2VkRXh0ZW5zaW9ucyA9IFsnanBnJywgJ2pwZWcnLCAncG5nJywgJ2dpZicsICd3ZWJwJ107XHJcbiAgICBjb25zdCBleHQgPSBmaWxlbmFtZS5zcGxpdCgnLicpLnBvcCgpPy50b0xvd2VyQ2FzZSgpO1xyXG4gICAgcmV0dXJuIGV4dCA/IGFsbG93ZWRFeHRlbnNpb25zLmluY2x1ZGVzKGV4dCkgOiBmYWxzZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2VuZXJhdGVGaWxlTmFtZShvcmlnaW5hbE5hbWU6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBmaWxlRXh0ID0gb3JpZ2luYWxOYW1lLnNwbGl0KCcuJykucG9wKCk/LnRvTG93ZXJDYXNlKCkgfHwgJ2pwZyc7XHJcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xyXG4gICAgY29uc3QgcmFuZG9tU3RyID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpO1xyXG4gICAgcmV0dXJuIGAke3RpbWVzdGFtcH1fJHtyYW5kb21TdHJ9LiR7ZmlsZUV4dH1gO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0RXZlbnRzKCk6IFByb21pc2U8RXZlbnRbXT4ge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5vcmRlcignZGF0ZScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgIHJldHVybiBkYXRhIHx8IFtdO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0U2ltcGxlQ29tcHJlc3Npb25BbmFseXRpY3MoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBHZXQgcGhvdG9zIHdpdGggY29tcHJlc3Npb24gZGF0YSAoc2ltcGxpZmllZCB2ZXJzaW9uKVxyXG4gICAgICBjb25zdCB7IGRhdGE6IHBob3RvcywgZXJyb3I6IHBob3Rvc0Vycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Bob3RvcycpXHJcbiAgICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgICAgLm5vdCgnb3B0aW1pemVkX2ltYWdlcycsICdpcycsIG51bGwpXHJcbiAgICAgICAgLm9yZGVyKCd1cGxvYWRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAgIC5saW1pdCgxMDApOyAvLyBMaW1pdCB0byByZWNlbnQgMTAwIHBob3Rvc1xyXG5cclxuICAgICAgaWYgKHBob3Rvc0Vycm9yKSB0aHJvdyBwaG90b3NFcnJvcjtcclxuXHJcbiAgICAgIC8vIENhbGN1bGF0ZSBzaW1wbGUgYW5hbHl0aWNzXHJcbiAgICAgIGNvbnN0IHRvdGFsUGhvdG9zID0gcGhvdG9zPy5sZW5ndGggfHwgMDtcclxuICAgICAgbGV0IHRvdGFsT3JpZ2luYWxTaXplID0gMDtcclxuICAgICAgbGV0IHRvdGFsT3B0aW1pemVkU2l6ZSA9IDA7XHJcbiAgICAgIGxldCB0b3RhbFNhdmluZ3NCeXRlcyA9IDA7XHJcblxyXG4gICAgICBjb25zdCByZWNlbnRQaG90b3M6IGFueVtdID0gW107XHJcblxyXG4gICAgICBwaG90b3M/LmZvckVhY2gocGhvdG8gPT4ge1xyXG4gICAgICAgIGlmIChwaG90by5pbWFnZV9tZXRhZGF0YSAmJiBwaG90by5vcHRpbWl6ZWRfaW1hZ2VzKSB7XHJcbiAgICAgICAgICBjb25zdCBvcmlnaW5hbFNpemUgPSBwaG90by5pbWFnZV9tZXRhZGF0YS5vcmlnaW5hbF9zaXplIHx8IDA7XHJcbiAgICAgICAgICBjb25zdCBvcHRpbWl6ZWRTaXplID0gcGhvdG8ub3B0aW1pemVkX2ltYWdlcy5tZWRpdW0/LnNpemUgfHwgMDtcclxuICAgICAgICAgIGNvbnN0IHNhdmluZ3MgPSBvcmlnaW5hbFNpemUgLSBvcHRpbWl6ZWRTaXplO1xyXG4gICAgICAgICAgY29uc3Qgc2F2aW5nc1BlcmNlbnRhZ2UgPSBvcmlnaW5hbFNpemUgPiAwID8gKHNhdmluZ3MgLyBvcmlnaW5hbFNpemUpICogMTAwIDogMDtcclxuXHJcbiAgICAgICAgICB0b3RhbE9yaWdpbmFsU2l6ZSArPSBvcmlnaW5hbFNpemU7XHJcbiAgICAgICAgICB0b3RhbE9wdGltaXplZFNpemUgKz0gb3B0aW1pemVkU2l6ZTtcclxuICAgICAgICAgIHRvdGFsU2F2aW5nc0J5dGVzICs9IHNhdmluZ3M7XHJcblxyXG4gICAgICAgICAgLy8gUmVjZW50IHBob3RvcyAodG9wIDEwKVxyXG4gICAgICAgICAgaWYgKHJlY2VudFBob3Rvcy5sZW5ndGggPCAxMCkge1xyXG4gICAgICAgICAgICByZWNlbnRQaG90b3MucHVzaCh7XHJcbiAgICAgICAgICAgICAgaWQ6IHBob3RvLmlkLFxyXG4gICAgICAgICAgICAgIG9yaWdpbmFsX25hbWU6IHBob3RvLm9yaWdpbmFsX25hbWUsXHJcbiAgICAgICAgICAgICAgb3JpZ2luYWxfc2l6ZTogb3JpZ2luYWxTaXplLFxyXG4gICAgICAgICAgICAgIG9wdGltaXplZF9zaXplOiBvcHRpbWl6ZWRTaXplLFxyXG4gICAgICAgICAgICAgIHNhdmluZ3NfcGVyY2VudGFnZTogc2F2aW5nc1BlcmNlbnRhZ2UsXHJcbiAgICAgICAgICAgICAgdXBsb2FkZWRfYXQ6IHBob3RvLnVwbG9hZGVkX2F0XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCB0b3RhbFNhdmluZ3NQZXJjZW50YWdlID0gdG90YWxPcmlnaW5hbFNpemUgPiAwID8gKHRvdGFsU2F2aW5nc0J5dGVzIC8gdG90YWxPcmlnaW5hbFNpemUpICogMTAwIDogMDtcclxuICAgICAgY29uc3QgYXZlcmFnZUNvbXByZXNzaW9uUmF0aW8gPSB0b3RhbE9wdGltaXplZFNpemUgPiAwID8gdG90YWxPcmlnaW5hbFNpemUgLyB0b3RhbE9wdGltaXplZFNpemUgOiAxO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB0b3RhbFBob3RvcyxcclxuICAgICAgICB0b3RhbE9yaWdpbmFsU2l6ZSxcclxuICAgICAgICB0b3RhbE9wdGltaXplZFNpemUsXHJcbiAgICAgICAgdG90YWxTYXZpbmdzQnl0ZXMsXHJcbiAgICAgICAgdG90YWxTYXZpbmdzUGVyY2VudGFnZSxcclxuICAgICAgICBzdG9yYWdlU2F2ZWQ6IHRoaXMuZm9ybWF0RmlsZVNpemUodG90YWxTYXZpbmdzQnl0ZXMpLFxyXG4gICAgICAgIGF2ZXJhZ2VDb21wcmVzc2lvblJhdGlvLFxyXG4gICAgICAgIHJlY2VudFBob3RvczogcmVjZW50UGhvdG9zLnNvcnQoKGEsIGIpID0+IGIuc2F2aW5nc19wZXJjZW50YWdlIC0gYS5zYXZpbmdzX3BlcmNlbnRhZ2UpXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIHNpbXBsZSBjb21wcmVzc2lvbiBhbmFseXRpY3M6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZm9ybWF0RmlsZVNpemUoYnl0ZXM6IG51bWJlcik6IHN0cmluZyB7XHJcbiAgICBpZiAoYnl0ZXMgPT09IDApIHJldHVybiAnMCBCeXRlcyc7XHJcbiAgICBjb25zdCBrID0gMTAyNDtcclxuICAgIGNvbnN0IHNpemVzID0gWydCeXRlcycsICdLQicsICdNQicsICdHQiddO1xyXG4gICAgY29uc3QgaSA9IE1hdGguZmxvb3IoTWF0aC5sb2coYnl0ZXMpIC8gTWF0aC5sb2coaykpO1xyXG4gICAgcmV0dXJuIHBhcnNlRmxvYXQoKGJ5dGVzIC8gTWF0aC5wb3coaywgaSkpLnRvRml4ZWQoMikpICsgJyAnICsgc2l6ZXNbaV07XHJcbiAgfVxyXG5cclxuICBhc3luYyB2YWxpZGF0ZUV2ZW50QWNjZXNzKGV2ZW50SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGlzX3ByZW1pdW0nKVxyXG4gICAgICAuZXEoJ2lkJywgZXZlbnRJZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IgfHwgIWRhdGEpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFdmVudCBub3QgZm91bmQnKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgdXBsb2FkRXZlbnRQaG90byhldmVudElkOiBzdHJpbmcsIGZpbGU6IEZpbGUsIHVwbG9hZGVyTmFtZTogc3RyaW5nID0gJ0Fub255bW91cycsIGFsYnVtTmFtZTogc3RyaW5nID0gJ1RhbXUnKTogUHJvbWlzZTxQaG90bz4ge1xyXG4gICAgLy8gVmFsaWRhdGUgZXZlbnRJZCBleGlzdHNcclxuICAgIGF3YWl0IHRoaXMudmFsaWRhdGVFdmVudEFjY2VzcyhldmVudElkKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIGV4dGVuc2lvblxyXG4gICAgaWYgKCF0aGlzLnZhbGlkYXRlRmlsZUV4dGVuc2lvbihmaWxlLm5hbWUpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBmaWxlIHR5cGUuIEFsbG93ZWQ6IGpwZywganBlZywgcG5nLCBnaWYsIHdlYnAnKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBDb252ZXJ0IEZpbGUgdG8gQnVmZmVyIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nXHJcbiAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpO1xyXG4gICAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlcik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBQcm9jZXNzIGltYWdlIHdpdGggb3B0aW1pemF0aW9uIChzZXJ2ZXItc2lkZSlcclxuICAgICAgY29uc3Qgb3B0aW1pemVkSW1hZ2VzID0gYXdhaXQgdGhpcy5pbWFnZU9wdGltaXplci5wcm9jZXNzSW1hZ2UoYnVmZmVyLCBmaWxlLm5hbWUsIGBldmVudHMvJHtldmVudElkfWApO1xyXG4gICAgICBcclxuICAgICAgLy8gR2V0IGltYWdlIG1ldGFkYXRhXHJcbiAgICAgIGNvbnN0IHNoYXJwID0gKGF3YWl0IGltcG9ydCgnc2hhcnAnKSkuZGVmYXVsdDtcclxuICAgICAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCBzaGFycChidWZmZXIpLm1ldGFkYXRhKCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBpbWFnZU1ldGFkYXRhID0ge1xyXG4gICAgICAgIHdpZHRoOiBtZXRhZGF0YS53aWR0aCB8fCAwLFxyXG4gICAgICAgIGhlaWdodDogbWV0YWRhdGEuaGVpZ2h0IHx8IDAsXHJcbiAgICAgICAgZm9ybWF0OiBtZXRhZGF0YS5mb3JtYXQgfHwgJ2pwZWcnLFxyXG4gICAgICAgIG9yaWdpbmFsX3NpemU6IGJ1ZmZlci5sZW5ndGhcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIENhbGN1bGF0ZSBjb21wcmVzc2lvbiBzdGF0c1xyXG4gICAgICBjb25zdCBjb21wcmVzc2lvblN0YXRzID0gSW1hZ2VPcHRpbWl6ZXJTZXJ2ZXIuZ2V0Q29tcHJlc3Npb25TdGF0cyhvcHRpbWl6ZWRJbWFnZXMpO1xyXG5cclxuICAgICAgY29uc3QgeyBkYXRhOiBwaG90b0RhdGEsIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwaG90b3MnKVxyXG4gICAgICAgIC5pbnNlcnQoeyBcclxuICAgICAgICAgIGV2ZW50X2lkOiBldmVudElkLFxyXG4gICAgICAgICAgdXJsOiBvcHRpbWl6ZWRJbWFnZXMub3JpZ2luYWwudXJsLCAvLyBLZWVwIG9yaWdpbmFsIFVSTCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxyXG4gICAgICAgICAgdGh1bWJuYWlsX3VybDogb3B0aW1pemVkSW1hZ2VzLnRodW1ibmFpbC51cmwsXHJcbiAgICAgICAgICBvcmlnaW5hbF9uYW1lOiBmaWxlLm5hbWUsXHJcbiAgICAgICAgICB1cGxvYWRlcl9uYW1lOiB1cGxvYWRlck5hbWUsXHJcbiAgICAgICAgICBhbGJ1bV9uYW1lOiBhbGJ1bU5hbWUsXHJcbiAgICAgICAgICBpc19ob21lcGFnZTogZmFsc2UsXHJcbiAgICAgICAgICBmaWxlbmFtZTogdGhpcy5nZW5lcmF0ZUZpbGVOYW1lKGZpbGUubmFtZSksXHJcbiAgICAgICAgICBvcHRpbWl6ZWRfaW1hZ2VzOiBvcHRpbWl6ZWRJbWFnZXMsXHJcbiAgICAgICAgICBpbWFnZV9tZXRhZGF0YTogaW1hZ2VNZXRhZGF0YSxcclxuICAgICAgICAgIGNvbXByZXNzaW9uX3N0YXRzOiBjb21wcmVzc2lvblN0YXRzXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc2VsZWN0KClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHRocm93IGluc2VydEVycm9yO1xyXG4gICAgICByZXR1cm4gcGhvdG9EYXRhO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBsb2FkaW5nIG9wdGltaXplZCBldmVudCBwaG90bzonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgdXBsb2FkSG9tZXBhZ2VQaG90byhmaWxlOiBGaWxlKTogUHJvbWlzZTxQaG90bz4ge1xyXG4gICAgLy8gVmFsaWRhdGUgZmlsZSBleHRlbnNpb25cclxuICAgIGlmICghdGhpcy52YWxpZGF0ZUZpbGVFeHRlbnNpb24oZmlsZS5uYW1lKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZmlsZSB0eXBlLiBBbGxvd2VkOiBqcGcsIGpwZWcsIHBuZywgZ2lmLCB3ZWJwJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQ29udmVydCBGaWxlIHRvIEJ1ZmZlciBmb3Igc2VydmVyLXNpZGUgcHJvY2Vzc2luZ1xyXG4gICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTtcclxuICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oYXJyYXlCdWZmZXIpO1xyXG4gICAgICBcclxuICAgICAgLy8gUHJvY2VzcyBpbWFnZSB3aXRoIG9wdGltaXphdGlvbiAoc2VydmVyLXNpZGUpXHJcbiAgICAgIGNvbnN0IG9wdGltaXplZEltYWdlcyA9IGF3YWl0IHRoaXMuaW1hZ2VPcHRpbWl6ZXIucHJvY2Vzc0ltYWdlKGJ1ZmZlciwgZmlsZS5uYW1lLCAnaG9tZXBhZ2UnKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEdldCBpbWFnZSBtZXRhZGF0YVxyXG4gICAgICBjb25zdCBzaGFycCA9IChhd2FpdCBpbXBvcnQoJ3NoYXJwJykpLmRlZmF1bHQ7XHJcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgc2hhcnAoYnVmZmVyKS5tZXRhZGF0YSgpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgaW1hZ2VNZXRhZGF0YSA9IHtcclxuICAgICAgICB3aWR0aDogbWV0YWRhdGEud2lkdGggfHwgMCxcclxuICAgICAgICBoZWlnaHQ6IG1ldGFkYXRhLmhlaWdodCB8fCAwLFxyXG4gICAgICAgIGZvcm1hdDogbWV0YWRhdGEuZm9ybWF0IHx8ICdqcGVnJyxcclxuICAgICAgICBvcmlnaW5hbF9zaXplOiBidWZmZXIubGVuZ3RoXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBDYWxjdWxhdGUgY29tcHJlc3Npb24gc3RhdHNcclxuICAgICAgY29uc3QgY29tcHJlc3Npb25TdGF0cyA9IEltYWdlT3B0aW1pemVyU2VydmVyLmdldENvbXByZXNzaW9uU3RhdHMob3B0aW1pemVkSW1hZ2VzKTtcclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogcGhvdG9EYXRhLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncGhvdG9zJylcclxuICAgICAgICAuaW5zZXJ0KHsgXHJcbiAgICAgICAgICB1cmw6IG9wdGltaXplZEltYWdlcy5vcmlnaW5hbC51cmwsIC8vIEtlZXAgb3JpZ2luYWwgVVJMIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XHJcbiAgICAgICAgICB0aHVtYm5haWxfdXJsOiBvcHRpbWl6ZWRJbWFnZXMudGh1bWJuYWlsLnVybCxcclxuICAgICAgICAgIG9yaWdpbmFsX25hbWU6IGZpbGUubmFtZSxcclxuICAgICAgICAgIGlzX2hvbWVwYWdlOiB0cnVlLFxyXG4gICAgICAgICAgZXZlbnRfaWQ6IG51bGwsXHJcbiAgICAgICAgICB1cGxvYWRlcl9uYW1lOiAnQWRtaW4nLFxyXG4gICAgICAgICAgYWxidW1fbmFtZTogJ0hvbWVwYWdlJyxcclxuICAgICAgICAgIGZpbGVuYW1lOiB0aGlzLmdlbmVyYXRlRmlsZU5hbWUoZmlsZS5uYW1lKSxcclxuICAgICAgICAgIG9wdGltaXplZF9pbWFnZXM6IG9wdGltaXplZEltYWdlcyxcclxuICAgICAgICAgIGltYWdlX21ldGFkYXRhOiBpbWFnZU1ldGFkYXRhLFxyXG4gICAgICAgICAgY29tcHJlc3Npb25fc3RhdHM6IGNvbXByZXNzaW9uU3RhdHNcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChpbnNlcnRFcnJvcikgdGhyb3cgaW5zZXJ0RXJyb3I7XHJcbiAgICAgIHJldHVybiBwaG90b0RhdGE7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGxvYWRpbmcgb3B0aW1pemVkIGhvbWVwYWdlIHBob3RvOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgYXN5bmMgZ2V0UGhvdG9CeUlkKHBob3RvSWQ6IHN0cmluZyk6IFByb21pc2U8UGhvdG8gfCBudWxsPiB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwaG90b3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdpZCcsIHBob3RvSWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZGVsZXRlUGhvdG8ocGhvdG9JZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAvLyBHZXQgcGhvdG8gZGV0YWlsc1xyXG4gICAgY29uc3QgcGhvdG8gPSBhd2FpdCB0aGlzLmdldFBob3RvQnlJZChwaG90b0lkKTtcclxuICAgIGlmICghcGhvdG8pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdQaG90byBub3QgZm91bmQnKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBFeHRyYWN0IGZpbGUgcGF0aCBmcm9tIFVSTCBvciB1c2Ugc3RvcmVkIGZpbGVuYW1lXHJcbiAgICAgIGxldCBmaWxlUGF0aDogc3RyaW5nO1xyXG4gICAgICBcclxuICAgICAgaWYgKHBob3RvLmZpbGVuYW1lKSB7XHJcbiAgICAgICAgLy8gVXNlIHN0b3JlZCBmaWxlbmFtZSBpZiBhdmFpbGFibGVcclxuICAgICAgICBpZiAocGhvdG8uaXNfaG9tZXBhZ2UpIHtcclxuICAgICAgICAgIGZpbGVQYXRoID0gYGhvbWVwYWdlLyR7cGhvdG8uZmlsZW5hbWV9YDtcclxuICAgICAgICB9IGVsc2UgaWYgKHBob3RvLmV2ZW50X2lkKSB7XHJcbiAgICAgICAgICBmaWxlUGF0aCA9IGBldmVudHMvJHtwaG90by5ldmVudF9pZH0vJHtwaG90by5maWxlbmFtZX1gO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBGYWxsYmFjayBpZiBzdHJ1Y3R1cmUgaXMgdW5jbGVhclxyXG4gICAgICAgICAgZmlsZVBhdGggPSBwaG90by5maWxlbmFtZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRXh0cmFjdCBmcm9tIFVSTCBhcyBmYWxsYmFja1xyXG4gICAgICAgIGNvbnN0IHVybFBhcnRzID0gcGhvdG8udXJsLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSB1cmxQYXJ0c1t1cmxQYXJ0cy5sZW5ndGggLSAxXTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAocGhvdG8uaXNfaG9tZXBhZ2UpIHtcclxuICAgICAgICAgIGZpbGVQYXRoID0gYGhvbWVwYWdlLyR7ZmlsZU5hbWV9YDtcclxuICAgICAgICB9IGVsc2UgaWYgKHBob3RvLmV2ZW50X2lkKSB7XHJcbiAgICAgICAgICBmaWxlUGF0aCA9IGBldmVudHMvJHtwaG90by5ldmVudF9pZH0vJHtmaWxlTmFtZX1gO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBGYWxsYmFjayBpZiBzdHJ1Y3R1cmUgaXMgdW5jbGVhclxyXG4gICAgICAgICAgZmlsZVBhdGggPSBmaWxlTmFtZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIERlbGV0ZSBmcm9tIHN0b3JhZ2UgZmlyc3RcclxuICAgICAgY29uc3QgeyBlcnJvcjogZGVsZXRlU3RvcmFnZUVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlLnN0b3JhZ2VcclxuICAgICAgICAuZnJvbSgncGhvdG9zJylcclxuICAgICAgICAucmVtb3ZlKFtmaWxlUGF0aF0pO1xyXG5cclxuICAgICAgaWYgKGRlbGV0ZVN0b3JhZ2VFcnJvcikge1xyXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZSBmcm9tIHN0b3JhZ2U6JywgZGVsZXRlU3RvcmFnZUVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQ29udGludWUgd2l0aCBkYXRhYmFzZSBkZWxldGlvbiBldmVuIGlmIHN0b3JhZ2UgZGVsZXRpb24gZmFpbHNcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVGhlbiBkZWxldGUgZnJvbSBkYXRhYmFzZVxyXG4gICAgICBjb25zdCB7IGVycm9yOiBkZWxldGVEYkVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Bob3RvcycpXHJcbiAgICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgICAgLmVxKCdpZCcsIHBob3RvSWQpO1xyXG5cclxuICAgICAgaWYgKGRlbGV0ZURiRXJyb3IpIHRocm93IGRlbGV0ZURiRXJyb3I7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAvLyBJZiBpdCdzIG5vdCBhIHN0b3JhZ2UgZXJyb3IsIHJldGhyb3dcclxuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IgJiYgIWVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ3N0b3JhZ2UnKSkge1xyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBGb3Igc3RvcmFnZSBlcnJvcnMsIHRyeSB0byBkZWxldGUgZnJvbSBkYXRhYmFzZSBhbnl3YXlcclxuICAgICAgY29uc3QgeyBlcnJvcjogZGVsZXRlRGJFcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwaG90b3MnKVxyXG4gICAgICAgIC5kZWxldGUoKVxyXG4gICAgICAgIC5lcSgnaWQnLCBwaG90b0lkKTtcclxuICAgICAgICBcclxuICAgICAgaWYgKGRlbGV0ZURiRXJyb3IpIHRocm93IGRlbGV0ZURiRXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBsaWtlUGhvdG8ocGhvdG9JZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlLnJwYygnaW5jcmVtZW50X2xpa2VzJywgeyBwaG90b19pZDogcGhvdG9JZCB9KTsgLy8gUGFuZ2dpbCBmdW5nc2kgUlBDXHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gIH1cclxuXHJcblxyXG4gIC8vIC0tLSBNZXRvZGUgUGVzYW4gLS0tXHJcbiAgYXN5bmMgZ2V0RXZlbnRNZXNzYWdlcyhldmVudElkOiBzdHJpbmcpOiBQcm9taXNlPE1lc3NhZ2VbXT4ge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbWVzc2FnZXMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdldmVudF9pZCcsIGV2ZW50SWQpXHJcbiAgICAgIC5vcmRlcignc2VudF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGNyZWF0ZU1lc3NhZ2UobWVzc2FnZTogT21pdDxNZXNzYWdlLCAnaWQnIHwgJ3NlbnRfYXQnIHwgJ2hlYXJ0cyc+KTogUHJvbWlzZTxNZXNzYWdlPiB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdtZXNzYWdlcycpXHJcbiAgICAgIC5pbnNlcnQobWVzc2FnZSlcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGhlYXJ0TWVzc2FnZShtZXNzYWdlSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZS5ycGMoJ2luY3JlbWVudF9oZWFydHMnLCB7IG1lc3NhZ2VfaWQ6IG1lc3NhZ2VJZCB9KTsgLy8gUGFuZ2dpbCBmdW5nc2kgUlBDXHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIE1ldG9kZSBTdGF0aXN0aWsgLS0tXHJcbiAgYXN5bmMgZ2V0U3RhdHMoKTogUHJvbWlzZTxTdGF0cz4ge1xyXG4gICAgY29uc3QgeyBjb3VudDogdG90YWxFdmVudHMsIGVycm9yOiBldmVudHNFcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgLnNlbGVjdCgnKicsIHsgY291bnQ6ICdleGFjdCcsIGhlYWQ6IHRydWUgfSk7XHJcbiAgICBpZiAoZXZlbnRzRXJyb3IpIHRocm93IGV2ZW50c0Vycm9yO1xyXG5cclxuICAgIGNvbnN0IHsgY291bnQ6IHRvdGFsUGhvdG9zLCBlcnJvcjogcGhvdG9zRXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Bob3RvcycpXHJcbiAgICAgIC5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pO1xyXG4gICAgaWYgKHBob3Rvc0Vycm9yKSB0aHJvdyBwaG90b3NFcnJvcjtcclxuXHJcbiAgICBjb25zdCB7IGNvdW50OiB0b3RhbE1lc3NhZ2VzLCBlcnJvcjogbWVzc2FnZXNFcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbWVzc2FnZXMnKVxyXG4gICAgICAuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JywgaGVhZDogdHJ1ZSB9KTtcclxuICAgIGlmIChtZXNzYWdlc0Vycm9yKSB0aHJvdyBtZXNzYWdlc0Vycm9yO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRvdGFsRXZlbnRzOiB0b3RhbEV2ZW50cyB8fCAwLFxyXG4gICAgICB0b3RhbFBob3RvczogdG90YWxQaG90b3MgfHwgMCxcclxuICAgICAgdG90YWxNZXNzYWdlczogdG90YWxNZXNzYWdlcyB8fCAwLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBkYXRhYmFzZSA9IG5ldyBEYXRhYmFzZVNlcnZpY2UoKTsgIl0sIm5hbWVzIjpbInN1cGFiYXNlQWRtaW4iLCJJbWFnZU9wdGltaXplclNlcnZlciIsIkRhdGFiYXNlU2VydmljZSIsImNvbnN0cnVjdG9yIiwic3VwYWJhc2UiLCJpbWFnZU9wdGltaXplciIsImdldEFsbEV2ZW50cyIsImRhdGEiLCJlcnJvciIsImZyb20iLCJzZWxlY3QiLCJvcmRlciIsImFzY2VuZGluZyIsImdldFB1YmxpY0V2ZW50cyIsImlzIiwiZ2V0RXZlbnRCeUlkIiwiaWQiLCJlcSIsInNpbmdsZSIsImNyZWF0ZUV2ZW50IiwiZXZlbnQiLCJuZXdFdmVudCIsImluc2VydCIsImJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfQVBQX1VSTCIsImV2ZW50VXJsIiwiYWNjZXNzX2NvZGUiLCJxckNvZGVVcmwiLCJlbmNvZGVVUklDb21wb25lbnQiLCJ1cGRhdGVkRXZlbnQiLCJ1cGRhdGVFcnJvciIsInVwZGF0ZSIsInFyX2NvZGUiLCJzaGFyZWFibGVfbGluayIsImNvbnNvbGUiLCJ1cGRhdGVFdmVudCIsInVwZGF0ZXMiLCJkZWxldGVFdmVudCIsImRlbGV0ZSIsInZlcmlmeUV2ZW50QWNjZXNzQ29kZSIsImV2ZW50SWQiLCJjb2RlIiwiZ2V0RXZlbnRQaG90b3MiLCJnZXRIb21lcGFnZVBob3RvcyIsInZhbGlkYXRlRmlsZUV4dGVuc2lvbiIsImZpbGVuYW1lIiwiYWxsb3dlZEV4dGVuc2lvbnMiLCJleHQiLCJzcGxpdCIsInBvcCIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJnZW5lcmF0ZUZpbGVOYW1lIiwib3JpZ2luYWxOYW1lIiwiZmlsZUV4dCIsInRpbWVzdGFtcCIsIkRhdGUiLCJub3ciLCJyYW5kb21TdHIiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHJpbmciLCJnZXRFdmVudHMiLCJnZXRTaW1wbGVDb21wcmVzc2lvbkFuYWx5dGljcyIsInBob3RvcyIsInBob3Rvc0Vycm9yIiwibm90IiwibGltaXQiLCJ0b3RhbFBob3RvcyIsImxlbmd0aCIsInRvdGFsT3JpZ2luYWxTaXplIiwidG90YWxPcHRpbWl6ZWRTaXplIiwidG90YWxTYXZpbmdzQnl0ZXMiLCJyZWNlbnRQaG90b3MiLCJmb3JFYWNoIiwicGhvdG8iLCJpbWFnZV9tZXRhZGF0YSIsIm9wdGltaXplZF9pbWFnZXMiLCJvcmlnaW5hbFNpemUiLCJvcmlnaW5hbF9zaXplIiwib3B0aW1pemVkU2l6ZSIsIm1lZGl1bSIsInNpemUiLCJzYXZpbmdzIiwic2F2aW5nc1BlcmNlbnRhZ2UiLCJwdXNoIiwib3JpZ2luYWxfbmFtZSIsIm9wdGltaXplZF9zaXplIiwic2F2aW5nc19wZXJjZW50YWdlIiwidXBsb2FkZWRfYXQiLCJ0b3RhbFNhdmluZ3NQZXJjZW50YWdlIiwiYXZlcmFnZUNvbXByZXNzaW9uUmF0aW8iLCJzdG9yYWdlU2F2ZWQiLCJmb3JtYXRGaWxlU2l6ZSIsInNvcnQiLCJhIiwiYiIsImJ5dGVzIiwiayIsInNpemVzIiwiaSIsImZsb29yIiwibG9nIiwicGFyc2VGbG9hdCIsInBvdyIsInRvRml4ZWQiLCJ2YWxpZGF0ZUV2ZW50QWNjZXNzIiwiRXJyb3IiLCJ1cGxvYWRFdmVudFBob3RvIiwiZmlsZSIsInVwbG9hZGVyTmFtZSIsImFsYnVtTmFtZSIsIm5hbWUiLCJhcnJheUJ1ZmZlciIsImJ1ZmZlciIsIkJ1ZmZlciIsIm9wdGltaXplZEltYWdlcyIsInByb2Nlc3NJbWFnZSIsInNoYXJwIiwiZGVmYXVsdCIsIm1ldGFkYXRhIiwiaW1hZ2VNZXRhZGF0YSIsIndpZHRoIiwiaGVpZ2h0IiwiZm9ybWF0IiwiY29tcHJlc3Npb25TdGF0cyIsImdldENvbXByZXNzaW9uU3RhdHMiLCJwaG90b0RhdGEiLCJpbnNlcnRFcnJvciIsImV2ZW50X2lkIiwidXJsIiwib3JpZ2luYWwiLCJ0aHVtYm5haWxfdXJsIiwidGh1bWJuYWlsIiwidXBsb2FkZXJfbmFtZSIsImFsYnVtX25hbWUiLCJpc19ob21lcGFnZSIsImNvbXByZXNzaW9uX3N0YXRzIiwidXBsb2FkSG9tZXBhZ2VQaG90byIsImdldFBob3RvQnlJZCIsInBob3RvSWQiLCJkZWxldGVQaG90byIsImZpbGVQYXRoIiwidXJsUGFydHMiLCJmaWxlTmFtZSIsImRlbGV0ZVN0b3JhZ2VFcnJvciIsInN0b3JhZ2UiLCJyZW1vdmUiLCJkZWxldGVEYkVycm9yIiwibWVzc2FnZSIsImxpa2VQaG90byIsInJwYyIsInBob3RvX2lkIiwiZ2V0RXZlbnRNZXNzYWdlcyIsImNyZWF0ZU1lc3NhZ2UiLCJoZWFydE1lc3NhZ2UiLCJtZXNzYWdlSWQiLCJtZXNzYWdlX2lkIiwiZ2V0U3RhdHMiLCJjb3VudCIsInRvdGFsRXZlbnRzIiwiZXZlbnRzRXJyb3IiLCJoZWFkIiwidG90YWxNZXNzYWdlcyIsIm1lc3NhZ2VzRXJyb3IiLCJkYXRhYmFzZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/database.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/image-optimizer-server.ts":
/*!*******************************************!*\
  !*** ./src/lib/image-optimizer-server.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ImageOptimizerServer: () => (/* binding */ ImageOptimizerServer)\n/* harmony export */ });\n/* harmony import */ var sharp__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! sharp */ \"sharp\");\n/* harmony import */ var sharp__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(sharp__WEBPACK_IMPORTED_MODULE_0__);\n/**\r\n * Server-side Image Optimization Service\r\n * Handles compression, resizing, and format conversion on the server\r\n */ \nclass ImageOptimizerServer {\n    constructor(supabase, bucketName = \"photos\"){\n        this.supabase = supabase;\n        this.bucketName = bucketName;\n    }\n    /**\r\n   * Generate filename for different sizes\r\n   */ generateFilename(originalName, size, timestamp) {\n        const ext = originalName.split(\".\").pop()?.toLowerCase() || \"jpg\";\n        const nameWithoutExt = originalName.replace(/\\.[^/.]+$/, \"\");\n        const cleanName = nameWithoutExt.replace(/[^a-zA-Z0-9]/g, \"_\");\n        return `${timestamp}_${cleanName}_${size}.${ext}`;\n    }\n    /**\r\n   * Optimize single image to specific size\r\n   */ async optimizeImage(buffer, width, height, quality) {\n        return await sharp__WEBPACK_IMPORTED_MODULE_0___default()(buffer).resize(width, height, {\n            fit: \"inside\",\n            withoutEnlargement: true,\n            background: {\n                r: 255,\n                g: 255,\n                b: 255,\n                alpha: 1\n            }\n        }).jpeg({\n            quality,\n            progressive: true,\n            mozjpeg: true\n        }).toBuffer();\n    }\n    /**\r\n   * Get image metadata\r\n   */ async getImageMetadata(buffer) {\n        const metadata = await sharp__WEBPACK_IMPORTED_MODULE_0___default()(buffer).metadata();\n        return {\n            width: metadata.width || 0,\n            height: metadata.height || 0,\n            format: metadata.format || \"jpeg\",\n            size: buffer.length\n        };\n    }\n    /**\r\n   * Upload buffer to Supabase Storage\r\n   */ async uploadToStorage(buffer, filePath, contentType = \"image/jpeg\") {\n        const { data, error } = await this.supabase.storage.from(this.bucketName).upload(filePath, buffer, {\n            contentType,\n            cacheControl: \"31536000\",\n            upsert: false\n        });\n        if (error) throw error;\n        const { data: publicUrlData } = this.supabase.storage.from(this.bucketName).getPublicUrl(data.path);\n        return publicUrlData.publicUrl;\n    }\n    /**\r\n   * Process and optimize image for all sizes (SERVER-SIDE ONLY)\r\n   */ async processImage(buffer, originalName, folder = \"optimized\") {\n        try {\n            // Get original metadata\n            const originalMetadata = await this.getImageMetadata(buffer);\n            const timestamp = Date.now();\n            const randomId = Math.random().toString(36).substring(2, 8);\n            // Define sizes\n            const sizes = {\n                thumbnail: {\n                    width: 300,\n                    height: 225,\n                    quality: 85\n                },\n                small: {\n                    width: 800,\n                    height: 600,\n                    quality: 90\n                },\n                medium: {\n                    width: 1200,\n                    height: 900,\n                    quality: 92\n                },\n                large: {\n                    width: 1920,\n                    height: 1440,\n                    quality: 95\n                }\n            };\n            // Upload original\n            const originalPath = `${folder}/original/${timestamp}_${randomId}_original.jpg`;\n            const originalUrl = await this.uploadToStorage(buffer, originalPath);\n            // Process and upload optimized versions\n            const results = {\n                original: {\n                    url: originalUrl,\n                    size: originalMetadata.size,\n                    width: originalMetadata.width,\n                    height: originalMetadata.height\n                },\n                thumbnail: {\n                    url: \"\",\n                    size: 0\n                },\n                small: {\n                    url: \"\",\n                    size: 0\n                },\n                medium: {\n                    url: \"\",\n                    size: 0\n                },\n                large: {\n                    url: \"\",\n                    size: 0\n                }\n            };\n            // Process each size\n            for (const [sizeName, config] of Object.entries(sizes)){\n                const optimizedBuffer = await this.optimizeImage(buffer, config.width, config.height, config.quality);\n                const optimizedPath = `${folder}/${sizeName}/${timestamp}_${randomId}_${sizeName}.jpg`;\n                const optimizedUrl = await this.uploadToStorage(optimizedBuffer, optimizedPath);\n                results[sizeName] = {\n                    url: optimizedUrl,\n                    size: optimizedBuffer.length\n                };\n            }\n            return results;\n        } catch (error) {\n            console.error(\"Image processing error:\", error);\n            throw new Error(\"Failed to process image\");\n        }\n    }\n    /**\r\n   * Get appropriate image URL based on viewport/usage\r\n   */ static getOptimalImageUrl(images, usage) {\n        switch(usage){\n            case \"thumbnail\":\n                return images.thumbnail.url;\n            case \"gallery\":\n                return images.medium.url;\n            case \"lightbox\":\n                return images.large.url;\n            case \"download\":\n                return images.original.url;\n            case \"mobile\":\n                return images.small.url;\n            default:\n                return images.medium.url;\n        }\n    }\n    /**\r\n   * Get responsive image sources for different screen sizes\r\n   */ static getResponsiveSources(images) {\n        return {\n            srcSet: [\n                `${images.small.url} 800w`,\n                `${images.medium.url} 1200w`,\n                `${images.large.url} 1920w`\n            ].join(\", \"),\n            sizes: [\n                \"(max-width: 768px) 800px\",\n                \"(max-width: 1200px) 1200px\",\n                \"1920px\"\n            ].join(\", \"),\n            src: images.medium.url,\n            placeholder: images.thumbnail.url\n        };\n    }\n    /**\r\n   * Calculate compression savings\r\n   */ static getCompressionStats(images) {\n        const originalSize = images.original.size;\n        const optimizedSize = images.medium.size;\n        const savings = (originalSize - optimizedSize) / originalSize * 100;\n        return {\n            originalSize: this.formatFileSize(originalSize),\n            optimizedSize: this.formatFileSize(optimizedSize),\n            savings: Math.round(savings),\n            ratio: `${Math.round(originalSize / optimizedSize)}:1`\n        };\n    }\n    /**\r\n   * Format file size for display\r\n   */ static formatFileSize(bytes) {\n        if (bytes === 0) return \"0 Bytes\";\n        const k = 1024;\n        const sizes = [\n            \"Bytes\",\n            \"KB\",\n            \"MB\",\n            \"GB\"\n        ];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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d0IsSUFBSSxDQUFDO1lBQ1BDLEtBQUtMLE9BQU9qQixNQUFNLENBQUNNLEdBQUc7WUFDdEJpQixhQUFhTixPQUFPbkIsU0FBUyxDQUFDUSxHQUFHO1FBQ25DO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE9BQU9rQixvQkFBb0JQLE1BQXVCLEVBQUU7UUFDbEQsTUFBTVEsZUFBZVIsT0FBT1osUUFBUSxDQUFDOUQsSUFBSTtRQUN6QyxNQUFNbUYsZ0JBQWdCVCxPQUFPakIsTUFBTSxDQUFDekQsSUFBSTtRQUN4QyxNQUFNb0YsVUFBVSxDQUFFRixlQUFlQyxhQUFZLElBQUtELGVBQWdCO1FBRWxFLE9BQU87WUFDTEEsY0FBYyxJQUFJLENBQUNHLGNBQWMsQ0FBQ0g7WUFDbENDLGVBQWUsSUFBSSxDQUFDRSxjQUFjLENBQUNGO1lBQ25DQyxTQUFTbEMsS0FBS29DLEtBQUssQ0FBQ0Y7WUFDcEJHLE9BQU8sQ0FBQyxFQUFFckMsS0FBS29DLEtBQUssQ0FBQ0osZUFBZUMsZUFBZSxFQUFFLENBQUM7UUFDeEQ7SUFDRjtJQUVBOztHQUVDLEdBQ0QsT0FBT0UsZUFBZUcsS0FBYSxFQUFVO1FBQzNDLElBQUlBLFVBQVUsR0FBRyxPQUFPO1FBQ3hCLE1BQU1DLElBQUk7UUFDVixNQUFNbkMsUUFBUTtZQUFDO1lBQVM7WUFBTTtZQUFNO1NBQUs7UUFDekMsTUFBTW9DLElBQUl4QyxLQUFLeUMsS0FBSyxDQUFDekMsS0FBSzBDLEdBQUcsQ0FBQ0osU0FBU3RDLEtBQUswQyxHQUFHLENBQUNIO1FBQ2hELE9BQU9JLFdBQVcsQ0FBQ0wsUUFBUXRDLEtBQUs0QyxHQUFHLENBQUNMLEdBQUdDLEVBQUMsRUFBR0ssT0FBTyxDQUFDLE1BQU0sTUFBTXpDLEtBQUssQ0FBQ29DLEVBQUU7SUFDekU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2hhZmlwb3J0cmFpdC1uZXh0anMvLi9zcmMvbGliL2ltYWdlLW9wdGltaXplci1zZXJ2ZXIudHM/ZjBlYyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogU2VydmVyLXNpZGUgSW1hZ2UgT3B0aW1pemF0aW9uIFNlcnZpY2VcclxuICogSGFuZGxlcyBjb21wcmVzc2lvbiwgcmVzaXppbmcsIGFuZCBmb3JtYXQgY29udmVyc2lvbiBvbiB0aGUgc2VydmVyXHJcbiAqL1xyXG5cclxuaW1wb3J0IHNoYXJwIGZyb20gJ3NoYXJwJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgT3B0aW1pemVkSW1hZ2VzIHtcclxuICBvcmlnaW5hbDoge1xyXG4gICAgdXJsOiBzdHJpbmc7XHJcbiAgICBzaXplOiBudW1iZXI7XHJcbiAgICB3aWR0aDogbnVtYmVyO1xyXG4gICAgaGVpZ2h0OiBudW1iZXI7XHJcbiAgfTtcclxuICB0aHVtYm5haWw6IHtcclxuICAgIHVybDogc3RyaW5nO1xyXG4gICAgc2l6ZTogbnVtYmVyO1xyXG4gIH07XHJcbiAgc21hbGw6IHtcclxuICAgIHVybDogc3RyaW5nO1xyXG4gICAgc2l6ZTogbnVtYmVyO1xyXG4gIH07XHJcbiAgbWVkaXVtOiB7XHJcbiAgICB1cmw6IHN0cmluZztcclxuICAgIHNpemU6IG51bWJlcjtcclxuICB9O1xyXG4gIGxhcmdlOiB7XHJcbiAgICB1cmw6IHN0cmluZztcclxuICAgIHNpemU6IG51bWJlcjtcclxuICB9O1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgSW1hZ2VPcHRpbWl6ZXJTZXJ2ZXIge1xyXG4gIHByaXZhdGUgc3VwYWJhc2U6IGFueTtcclxuICBwcml2YXRlIGJ1Y2tldE5hbWU6IHN0cmluZztcclxuXHJcbiAgY29uc3RydWN0b3Ioc3VwYWJhc2U6IGFueSwgYnVja2V0TmFtZTogc3RyaW5nID0gJ3Bob3RvcycpIHtcclxuICAgIHRoaXMuc3VwYWJhc2UgPSBzdXBhYmFzZTtcclxuICAgIHRoaXMuYnVja2V0TmFtZSA9IGJ1Y2tldE5hbWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSBmaWxlbmFtZSBmb3IgZGlmZmVyZW50IHNpemVzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZW5lcmF0ZUZpbGVuYW1lKG9yaWdpbmFsTmFtZTogc3RyaW5nLCBzaXplOiBzdHJpbmcsIHRpbWVzdGFtcDogbnVtYmVyKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGV4dCA9IG9yaWdpbmFsTmFtZS5zcGxpdCgnLicpLnBvcCgpPy50b0xvd2VyQ2FzZSgpIHx8ICdqcGcnO1xyXG4gICAgY29uc3QgbmFtZVdpdGhvdXRFeHQgPSBvcmlnaW5hbE5hbWUucmVwbGFjZSgvXFwuW14vLl0rJC8sICcnKTtcclxuICAgIGNvbnN0IGNsZWFuTmFtZSA9IG5hbWVXaXRob3V0RXh0LnJlcGxhY2UoL1teYS16QS1aMC05XS9nLCAnXycpO1xyXG4gICAgcmV0dXJuIGAke3RpbWVzdGFtcH1fJHtjbGVhbk5hbWV9XyR7c2l6ZX0uJHtleHR9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE9wdGltaXplIHNpbmdsZSBpbWFnZSB0byBzcGVjaWZpYyBzaXplXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBvcHRpbWl6ZUltYWdlKFxyXG4gICAgYnVmZmVyOiBCdWZmZXIsIFxyXG4gICAgd2lkdGg6IG51bWJlciwgXHJcbiAgICBoZWlnaHQ6IG51bWJlciwgXHJcbiAgICBxdWFsaXR5OiBudW1iZXJcclxuICApOiBQcm9taXNlPEJ1ZmZlcj4ge1xyXG4gICAgcmV0dXJuIGF3YWl0IHNoYXJwKGJ1ZmZlcilcclxuICAgICAgLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0LCB7XHJcbiAgICAgICAgZml0OiAnaW5zaWRlJyxcclxuICAgICAgICB3aXRob3V0RW5sYXJnZW1lbnQ6IHRydWUsXHJcbiAgICAgICAgYmFja2dyb3VuZDogeyByOiAyNTUsIGc6IDI1NSwgYjogMjU1LCBhbHBoYTogMSB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5qcGVnKHtcclxuICAgICAgICBxdWFsaXR5LFxyXG4gICAgICAgIHByb2dyZXNzaXZlOiB0cnVlLFxyXG4gICAgICAgIG1vempwZWc6IHRydWVcclxuICAgICAgfSlcclxuICAgICAgLnRvQnVmZmVyKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgaW1hZ2UgbWV0YWRhdGFcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGdldEltYWdlTWV0YWRhdGEoYnVmZmVyOiBCdWZmZXIpIHtcclxuICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgc2hhcnAoYnVmZmVyKS5tZXRhZGF0YSgpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgd2lkdGg6IG1ldGFkYXRhLndpZHRoIHx8IDAsXHJcbiAgICAgIGhlaWdodDogbWV0YWRhdGEuaGVpZ2h0IHx8IDAsXHJcbiAgICAgIGZvcm1hdDogbWV0YWRhdGEuZm9ybWF0IHx8ICdqcGVnJyxcclxuICAgICAgc2l6ZTogYnVmZmVyLmxlbmd0aFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwbG9hZCBidWZmZXIgdG8gU3VwYWJhc2UgU3RvcmFnZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgdXBsb2FkVG9TdG9yYWdlKFxyXG4gICAgYnVmZmVyOiBCdWZmZXIsIFxyXG4gICAgZmlsZVBhdGg6IHN0cmluZywgXHJcbiAgICBjb250ZW50VHlwZTogc3RyaW5nID0gJ2ltYWdlL2pwZWcnXHJcbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2Uuc3RvcmFnZVxyXG4gICAgICAuZnJvbSh0aGlzLmJ1Y2tldE5hbWUpXHJcbiAgICAgIC51cGxvYWQoZmlsZVBhdGgsIGJ1ZmZlciwge1xyXG4gICAgICAgIGNvbnRlbnRUeXBlLFxyXG4gICAgICAgIGNhY2hlQ29udHJvbDogJzMxNTM2MDAwJywgLy8gMSB5ZWFyIGNhY2hlXHJcbiAgICAgICAgdXBzZXJ0OiBmYWxzZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogcHVibGljVXJsRGF0YSB9ID0gdGhpcy5zdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKHRoaXMuYnVja2V0TmFtZSlcclxuICAgICAgLmdldFB1YmxpY1VybChkYXRhLnBhdGgpO1xyXG5cclxuICAgIHJldHVybiBwdWJsaWNVcmxEYXRhLnB1YmxpY1VybDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFByb2Nlc3MgYW5kIG9wdGltaXplIGltYWdlIGZvciBhbGwgc2l6ZXMgKFNFUlZFUi1TSURFIE9OTFkpXHJcbiAgICovXHJcbiAgYXN5bmMgcHJvY2Vzc0ltYWdlKFxyXG4gICAgYnVmZmVyOiBCdWZmZXIsIFxyXG4gICAgb3JpZ2luYWxOYW1lOiBzdHJpbmcsXHJcbiAgICBmb2xkZXI6IHN0cmluZyA9ICdvcHRpbWl6ZWQnXHJcbiAgKTogUHJvbWlzZTxPcHRpbWl6ZWRJbWFnZXM+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEdldCBvcmlnaW5hbCBtZXRhZGF0YVxyXG4gICAgICBjb25zdCBvcmlnaW5hbE1ldGFkYXRhID0gYXdhaXQgdGhpcy5nZXRJbWFnZU1ldGFkYXRhKGJ1ZmZlcik7XHJcbiAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XHJcbiAgICAgIGNvbnN0IHJhbmRvbUlkID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpO1xyXG5cclxuICAgICAgLy8gRGVmaW5lIHNpemVzXHJcbiAgICAgIGNvbnN0IHNpemVzID0ge1xyXG4gICAgICAgIHRodW1ibmFpbDogeyB3aWR0aDogMzAwLCBoZWlnaHQ6IDIyNSwgcXVhbGl0eTogODUgfSxcclxuICAgICAgICBzbWFsbDogeyB3aWR0aDogODAwLCBoZWlnaHQ6IDYwMCwgcXVhbGl0eTogOTAgfSxcclxuICAgICAgICBtZWRpdW06IHsgd2lkdGg6IDEyMDAsIGhlaWdodDogOTAwLCBxdWFsaXR5OiA5MiB9LFxyXG4gICAgICAgIGxhcmdlOiB7IHdpZHRoOiAxOTIwLCBoZWlnaHQ6IDE0NDAsIHF1YWxpdHk6IDk1IH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIFVwbG9hZCBvcmlnaW5hbFxyXG4gICAgICBjb25zdCBvcmlnaW5hbFBhdGggPSBgJHtmb2xkZXJ9L29yaWdpbmFsLyR7dGltZXN0YW1wfV8ke3JhbmRvbUlkfV9vcmlnaW5hbC5qcGdgO1xyXG4gICAgICBjb25zdCBvcmlnaW5hbFVybCA9IGF3YWl0IHRoaXMudXBsb2FkVG9TdG9yYWdlKGJ1ZmZlciwgb3JpZ2luYWxQYXRoKTtcclxuXHJcbiAgICAgIC8vIFByb2Nlc3MgYW5kIHVwbG9hZCBvcHRpbWl6ZWQgdmVyc2lvbnNcclxuICAgICAgY29uc3QgcmVzdWx0czogT3B0aW1pemVkSW1hZ2VzID0ge1xyXG4gICAgICAgIG9yaWdpbmFsOiB7XHJcbiAgICAgICAgICB1cmw6IG9yaWdpbmFsVXJsLFxyXG4gICAgICAgICAgc2l6ZTogb3JpZ2luYWxNZXRhZGF0YS5zaXplLFxyXG4gICAgICAgICAgd2lkdGg6IG9yaWdpbmFsTWV0YWRhdGEud2lkdGgsXHJcbiAgICAgICAgICBoZWlnaHQ6IG9yaWdpbmFsTWV0YWRhdGEuaGVpZ2h0XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0aHVtYm5haWw6IHsgdXJsOiAnJywgc2l6ZTogMCB9LFxyXG4gICAgICAgIHNtYWxsOiB7IHVybDogJycsIHNpemU6IDAgfSxcclxuICAgICAgICBtZWRpdW06IHsgdXJsOiAnJywgc2l6ZTogMCB9LFxyXG4gICAgICAgIGxhcmdlOiB7IHVybDogJycsIHNpemU6IDAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gUHJvY2VzcyBlYWNoIHNpemVcclxuICAgICAgZm9yIChjb25zdCBbc2l6ZU5hbWUsIGNvbmZpZ10gb2YgT2JqZWN0LmVudHJpZXMoc2l6ZXMpKSB7XHJcbiAgICAgICAgY29uc3Qgb3B0aW1pemVkQnVmZmVyID0gYXdhaXQgdGhpcy5vcHRpbWl6ZUltYWdlKFxyXG4gICAgICAgICAgYnVmZmVyLFxyXG4gICAgICAgICAgY29uZmlnLndpZHRoLFxyXG4gICAgICAgICAgY29uZmlnLmhlaWdodCxcclxuICAgICAgICAgIGNvbmZpZy5xdWFsaXR5XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgY29uc3Qgb3B0aW1pemVkUGF0aCA9IGAke2ZvbGRlcn0vJHtzaXplTmFtZX0vJHt0aW1lc3RhbXB9XyR7cmFuZG9tSWR9XyR7c2l6ZU5hbWV9LmpwZ2A7XHJcbiAgICAgICAgY29uc3Qgb3B0aW1pemVkVXJsID0gYXdhaXQgdGhpcy51cGxvYWRUb1N0b3JhZ2Uob3B0aW1pemVkQnVmZmVyLCBvcHRpbWl6ZWRQYXRoKTtcclxuXHJcbiAgICAgICAgcmVzdWx0c1tzaXplTmFtZSBhcyBrZXlvZiB0eXBlb2Ygc2l6ZXNdID0ge1xyXG4gICAgICAgICAgdXJsOiBvcHRpbWl6ZWRVcmwsXHJcbiAgICAgICAgICBzaXplOiBvcHRpbWl6ZWRCdWZmZXIubGVuZ3RoXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdJbWFnZSBwcm9jZXNzaW5nIGVycm9yOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcHJvY2VzcyBpbWFnZScpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGFwcHJvcHJpYXRlIGltYWdlIFVSTCBiYXNlZCBvbiB2aWV3cG9ydC91c2FnZVxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRPcHRpbWFsSW1hZ2VVcmwoXHJcbiAgICBpbWFnZXM6IE9wdGltaXplZEltYWdlcywgXHJcbiAgICB1c2FnZTogJ3RodW1ibmFpbCcgfCAnZ2FsbGVyeScgfCAnbGlnaHRib3gnIHwgJ2Rvd25sb2FkJyB8ICdtb2JpbGUnXHJcbiAgKTogc3RyaW5nIHtcclxuICAgIHN3aXRjaCAodXNhZ2UpIHtcclxuICAgICAgY2FzZSAndGh1bWJuYWlsJzpcclxuICAgICAgICByZXR1cm4gaW1hZ2VzLnRodW1ibmFpbC51cmw7XHJcbiAgICAgIGNhc2UgJ2dhbGxlcnknOlxyXG4gICAgICAgIHJldHVybiBpbWFnZXMubWVkaXVtLnVybDtcclxuICAgICAgY2FzZSAnbGlnaHRib3gnOlxyXG4gICAgICAgIHJldHVybiBpbWFnZXMubGFyZ2UudXJsO1xyXG4gICAgICBjYXNlICdkb3dubG9hZCc6XHJcbiAgICAgICAgcmV0dXJuIGltYWdlcy5vcmlnaW5hbC51cmw7XHJcbiAgICAgIGNhc2UgJ21vYmlsZSc6XHJcbiAgICAgICAgcmV0dXJuIGltYWdlcy5zbWFsbC51cmw7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIGltYWdlcy5tZWRpdW0udXJsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHJlc3BvbnNpdmUgaW1hZ2Ugc291cmNlcyBmb3IgZGlmZmVyZW50IHNjcmVlbiBzaXplc1xyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRSZXNwb25zaXZlU291cmNlcyhpbWFnZXM6IE9wdGltaXplZEltYWdlcykge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3JjU2V0OiBbXHJcbiAgICAgICAgYCR7aW1hZ2VzLnNtYWxsLnVybH0gODAwd2AsXHJcbiAgICAgICAgYCR7aW1hZ2VzLm1lZGl1bS51cmx9IDEyMDB3YCxcclxuICAgICAgICBgJHtpbWFnZXMubGFyZ2UudXJsfSAxOTIwd2BcclxuICAgICAgXS5qb2luKCcsICcpLFxyXG4gICAgICBzaXplczogW1xyXG4gICAgICAgICcobWF4LXdpZHRoOiA3NjhweCkgODAwcHgnLFxyXG4gICAgICAgICcobWF4LXdpZHRoOiAxMjAwcHgpIDEyMDBweCcsXHJcbiAgICAgICAgJzE5MjBweCdcclxuICAgICAgXS5qb2luKCcsICcpLFxyXG4gICAgICBzcmM6IGltYWdlcy5tZWRpdW0udXJsLCAvLyBGYWxsYmFja1xyXG4gICAgICBwbGFjZWhvbGRlcjogaW1hZ2VzLnRodW1ibmFpbC51cmxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxjdWxhdGUgY29tcHJlc3Npb24gc2F2aW5nc1xyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRDb21wcmVzc2lvblN0YXRzKGltYWdlczogT3B0aW1pemVkSW1hZ2VzKSB7XHJcbiAgICBjb25zdCBvcmlnaW5hbFNpemUgPSBpbWFnZXMub3JpZ2luYWwuc2l6ZTtcclxuICAgIGNvbnN0IG9wdGltaXplZFNpemUgPSBpbWFnZXMubWVkaXVtLnNpemU7XHJcbiAgICBjb25zdCBzYXZpbmdzID0gKChvcmlnaW5hbFNpemUgLSBvcHRpbWl6ZWRTaXplKSAvIG9yaWdpbmFsU2l6ZSkgKiAxMDA7XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG9yaWdpbmFsU2l6ZTogdGhpcy5mb3JtYXRGaWxlU2l6ZShvcmlnaW5hbFNpemUpLFxyXG4gICAgICBvcHRpbWl6ZWRTaXplOiB0aGlzLmZvcm1hdEZpbGVTaXplKG9wdGltaXplZFNpemUpLFxyXG4gICAgICBzYXZpbmdzOiBNYXRoLnJvdW5kKHNhdmluZ3MpLFxyXG4gICAgICByYXRpbzogYCR7TWF0aC5yb3VuZChvcmlnaW5hbFNpemUgLyBvcHRpbWl6ZWRTaXplKX06MWBcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGb3JtYXQgZmlsZSBzaXplIGZvciBkaXNwbGF5XHJcbiAgICovXHJcbiAgc3RhdGljIGZvcm1hdEZpbGVTaXplKGJ5dGVzOiBudW1iZXIpOiBzdHJpbmcge1xyXG4gICAgaWYgKGJ5dGVzID09PSAwKSByZXR1cm4gJzAgQnl0ZXMnO1xyXG4gICAgY29uc3QgayA9IDEwMjQ7XHJcbiAgICBjb25zdCBzaXplcyA9IFsnQnl0ZXMnLCAnS0InLCAnTUInLCAnR0InXTtcclxuICAgIGNvbnN0IGkgPSBNYXRoLmZsb29yKE1hdGgubG9nKGJ5dGVzKSAvIE1hdGgubG9nKGspKTtcclxuICAgIHJldHVybiBwYXJzZUZsb2F0KChieXRlcyAvIE1hdGgucG93KGssIGkpKS50b0ZpeGVkKDIpKSArICcgJyArIHNpemVzW2ldO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJzaGFycCIsIkltYWdlT3B0aW1pemVyU2VydmVyIiwiY29uc3RydWN0b3IiLCJzdXBhYmFzZSIsImJ1Y2tldE5hbWUiLCJnZW5lcmF0ZUZpbGVuYW1lIiwib3JpZ2luYWxOYW1lIiwic2l6ZSIsInRpbWVzdGFtcCIsImV4dCIsInNwbGl0IiwicG9wIiwidG9Mb3dlckNhc2UiLCJuYW1lV2l0aG91dEV4dCIsInJlcGxhY2UiLCJjbGVhbk5hbWUiLCJvcHRpbWl6ZUltYWdlIiwiYnVmZmVyIiwid2lkdGgiLCJoZWlnaHQiLCJxdWFsaXR5IiwicmVzaXplIiwiZml0Iiwid2l0aG91dEVubGFyZ2VtZW50IiwiYmFja2dyb3VuZCIsInIiLCJnIiwiYiIsImFscGhhIiwianBlZyIsInByb2dyZXNzaXZlIiwibW96anBlZyIsInRvQnVmZmVyIiwiZ2V0SW1hZ2VNZXRhZGF0YSIsIm1ldGFkYXRhIiwiZm9ybWF0IiwibGVuZ3RoIiwidXBsb2FkVG9TdG9yYWdlIiwiZmlsZVBhdGgiLCJjb250ZW50VHlwZSIsImRhdGEiLCJlcnJvciIsInN0b3JhZ2UiLCJmcm9tIiwidXBsb2FkIiwiY2FjaGVDb250cm9sIiwidXBzZXJ0IiwicHVibGljVXJsRGF0YSIsImdldFB1YmxpY1VybCIsInBhdGgiLCJwdWJsaWNVcmwiLCJwcm9jZXNzSW1hZ2UiLCJmb2xkZXIiLCJvcmlnaW5hbE1ldGFkYXRhIiwiRGF0ZSIsIm5vdyIsInJhbmRvbUlkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwic2l6ZXMiLCJ0aHVtYm5haWwiLCJzbWFsbCIsIm1lZGl1bSIsImxhcmdlIiwib3JpZ2luYWxQYXRoIiwib3JpZ2luYWxVcmwiLCJyZXN1bHRzIiwib3JpZ2luYWwiLCJ1cmwiLCJzaXplTmFtZSIsImNvbmZpZyIsIk9iamVjdCIsImVudHJpZXMiLCJvcHRpbWl6ZWRCdWZmZXIiLCJvcHRpbWl6ZWRQYXRoIiwib3B0aW1pemVkVXJsIiwiY29uc29sZSIsIkVycm9yIiwiZ2V0T3B0aW1hbEltYWdlVXJsIiwiaW1hZ2VzIiwidXNhZ2UiLCJnZXRSZXNwb25zaXZlU291cmNlcyIsInNyY1NldCIsImpvaW4iLCJzcmMiLCJwbGFjZWhvbGRlciIsImdldENvbXByZXNzaW9uU3RhdHMiLCJvcmlnaW5hbFNpemUiLCJvcHRpbWl6ZWRTaXplIiwic2F2aW5ncyIsImZvcm1hdEZpbGVTaXplIiwicm91bmQiLCJyYXRpbyIsImJ5dGVzIiwiayIsImkiLCJmbG9vciIsImxvZyIsInBhcnNlRmxvYXQiLCJwb3ciLCJ0b0ZpeGVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/image-optimizer-server.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase.ts":
/*!*****************************!*\
  !*** ./src/lib/supabase.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   STORAGE_BUCKET: () => (/* binding */ STORAGE_BUCKET),\n/* harmony export */   deleteFile: () => (/* binding */ deleteFile),\n/* harmony export */   generateFilePath: () => (/* binding */ generateFilePath),\n/* harmony export */   supabase: () => (/* binding */ supabase),\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin),\n/* harmony export */   uploadFile: () => (/* binding */ uploadFile)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Create Supabase client for client-side operations\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://azspktldiblhrwebzmwq.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6c3BrdGxkaWJsaHJ3ZWJ6bXdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NDQwNDQsImV4cCI6MjA2OTUyMDA0NH0.uKHB4K9hxUDTc0ZkwidCJv_Ev-oa99AflFvrFt_8MG8\");\n// Create Supabase admin client for server-side operations\n// Pastikan ini diekspor langsung agar 'database' bisa menggunakannya\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://azspktldiblhrwebzmwq.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n// Storage bucket name\nconst STORAGE_BUCKET = process.env.SUPABASE_STORAGE_BUCKET || \"photos\"; // Menggunakan default 'photos'\n// Upload file to Supabase Storage\nasync function uploadFile(file, path) {\n    const { data, error } = await supabaseAdmin.storage.from(STORAGE_BUCKET).upload(path, file, {\n        cacheControl: \"3600\",\n        upsert: false\n    });\n    if (error) {\n        throw new Error(`Upload failed: ${error.message}`);\n    }\n    // Get public URL\n    const { data: publicUrlData } = supabaseAdmin.storage.from(STORAGE_BUCKET).getPublicUrl(data.path);\n    return publicUrlData.publicUrl;\n}\n// Delete file from Supabase Storage\nasync function deleteFile(path) {\n    const { error } = await supabaseAdmin.storage.from(STORAGE_BUCKET).remove([\n        path\n    ]);\n    if (error) {\n        throw new Error(`Delete failed: ${error.message}`);\n    }\n}\n// Generate unique file path\nfunction generateFilePath(folder, originalName, eventId) {\n    const timestamp = Date.now();\n    const randomStr = Math.random().toString(36).substring(2, 8);\n    const fileExtension = originalName.split(\".\").pop();\n    const fileName = `${timestamp}_${randomStr}.${fileExtension}`;\n    if (eventId) {\n        return `${folder}/${eventId}/${fileName}`;\n    }\n    return `${folder}/${fileName}`;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBcUQ7QUFFckQsb0RBQW9EO0FBQzdDLE1BQU1DLFdBQVdELG1FQUFZQSxDQUNsQ0UsMENBQW9DLEVBQ3BDQSxrTkFBeUMsRUFDekM7QUFFRiwwREFBMEQ7QUFDMUQscUVBQXFFO0FBQzlELE1BQU1JLGdCQUFnQk4sbUVBQVlBLENBQ3ZDRSwwQ0FBb0MsRUFDcENBLFFBQVFDLEdBQUcsQ0FBQ0kseUJBQXlCLEVBQ3JDO0lBQ0VDLE1BQU07UUFDSkMsa0JBQWtCO1FBQ2xCQyxnQkFBZ0I7SUFDbEI7QUFDRixHQUNBO0FBRUYsc0JBQXNCO0FBQ2YsTUFBTUMsaUJBQWlCVCxRQUFRQyxHQUFHLENBQUNTLHVCQUF1QixJQUFJLFNBQVMsQ0FBQywrQkFBK0I7QUFFOUcsa0NBQWtDO0FBQzNCLGVBQWVDLFdBQVdDLElBQVUsRUFBRUMsSUFBWTtJQUN2RCxNQUFNLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTVgsY0FBY1ksT0FBTyxDQUNoREMsSUFBSSxDQUFDUixnQkFDTFMsTUFBTSxDQUFDTCxNQUFNRCxNQUFNO1FBQ2xCTyxjQUFjO1FBQ2RDLFFBQVE7SUFDVjtJQUVGLElBQUlMLE9BQU87UUFDVCxNQUFNLElBQUlNLE1BQU0sQ0FBQyxlQUFlLEVBQUVOLE1BQU1PLE9BQU8sQ0FBQyxDQUFDO0lBQ25EO0lBRUEsaUJBQWlCO0lBQ2pCLE1BQU0sRUFBRVIsTUFBTVMsYUFBYSxFQUFFLEdBQUduQixjQUFjWSxPQUFPLENBQ2xEQyxJQUFJLENBQUNSLGdCQUNMZSxZQUFZLENBQUNWLEtBQUtELElBQUk7SUFFekIsT0FBT1UsY0FBY0UsU0FBUztBQUNoQztBQUVBLG9DQUFvQztBQUM3QixlQUFlQyxXQUFXYixJQUFZO0lBQzNDLE1BQU0sRUFBRUUsS0FBSyxFQUFFLEdBQUcsTUFBTVgsY0FBY1ksT0FBTyxDQUMxQ0MsSUFBSSxDQUFDUixnQkFDTGtCLE1BQU0sQ0FBQztRQUFDZDtLQUFLO0lBRWhCLElBQUlFLE9BQU87UUFDVCxNQUFNLElBQUlNLE1BQU0sQ0FBQyxlQUFlLEVBQUVOLE1BQU1PLE9BQU8sQ0FBQyxDQUFDO0lBQ25EO0FBQ0Y7QUFFQSw0QkFBNEI7QUFDckIsU0FBU00saUJBQ2RDLE1BQWMsRUFDZEMsWUFBb0IsRUFDcEJDLE9BQWdCO0lBRWhCLE1BQU1DLFlBQVlDLEtBQUtDLEdBQUc7SUFDMUIsTUFBTUMsWUFBWUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsU0FBUyxDQUFDLEdBQUc7SUFDMUQsTUFBTUMsZ0JBQWdCVixhQUFhVyxLQUFLLENBQUMsS0FBS0MsR0FBRztJQUNqRCxNQUFNQyxXQUFXLENBQUMsRUFBRVgsVUFBVSxDQUFDLEVBQUVHLFVBQVUsQ0FBQyxFQUFFSyxjQUFjLENBQUM7SUFFN0QsSUFBSVQsU0FBUztRQUNYLE9BQU8sQ0FBQyxFQUFFRixPQUFPLENBQUMsRUFBRUUsUUFBUSxDQUFDLEVBQUVZLFNBQVMsQ0FBQztJQUMzQztJQUVBLE9BQU8sQ0FBQyxFQUFFZCxPQUFPLENBQUMsRUFBRWMsU0FBUyxDQUFDO0FBQ2hDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGFmaXBvcnRyYWl0LW5leHRqcy8uL3NyYy9saWIvc3VwYWJhc2UudHM/MDZlMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG4vLyBDcmVhdGUgU3VwYWJhc2UgY2xpZW50IGZvciBjbGllbnQtc2lkZSBvcGVyYXRpb25zXG5leHBvcnQgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIVxuKTtcblxuLy8gQ3JlYXRlIFN1cGFiYXNlIGFkbWluIGNsaWVudCBmb3Igc2VydmVyLXNpZGUgb3BlcmF0aW9uc1xuLy8gUGFzdGlrYW4gaW5pIGRpZWtzcG9yIGxhbmdzdW5nIGFnYXIgJ2RhdGFiYXNlJyBiaXNhIG1lbmdndW5ha2FubnlhXG5leHBvcnQgY29uc3Qgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChcbiAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcbiAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSEsXG4gIHtcbiAgICBhdXRoOiB7XG4gICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZVxuICAgIH1cbiAgfVxuKTtcblxuLy8gU3RvcmFnZSBidWNrZXQgbmFtZVxuZXhwb3J0IGNvbnN0IFNUT1JBR0VfQlVDS0VUID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU1RPUkFHRV9CVUNLRVQgfHwgJ3Bob3Rvcyc7IC8vIE1lbmdndW5ha2FuIGRlZmF1bHQgJ3Bob3RvcydcblxuLy8gVXBsb2FkIGZpbGUgdG8gU3VwYWJhc2UgU3RvcmFnZVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwbG9hZEZpbGUoZmlsZTogRmlsZSwgcGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5zdG9yYWdlXG4gICAgLmZyb20oU1RPUkFHRV9CVUNLRVQpXG4gICAgLnVwbG9hZChwYXRoLCBmaWxlLCB7XG4gICAgICBjYWNoZUNvbnRyb2w6ICczNjAwJyxcbiAgICAgIHVwc2VydDogZmFsc2VcbiAgICB9KTtcblxuICBpZiAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVwbG9hZCBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgfVxuXG4gIC8vIEdldCBwdWJsaWMgVVJMXG4gIGNvbnN0IHsgZGF0YTogcHVibGljVXJsRGF0YSB9ID0gc3VwYWJhc2VBZG1pbi5zdG9yYWdlXG4gICAgLmZyb20oU1RPUkFHRV9CVUNLRVQpXG4gICAgLmdldFB1YmxpY1VybChkYXRhLnBhdGgpO1xuXG4gIHJldHVybiBwdWJsaWNVcmxEYXRhLnB1YmxpY1VybDtcbn1cblxuLy8gRGVsZXRlIGZpbGUgZnJvbSBTdXBhYmFzZSBTdG9yYWdlXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlRmlsZShwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5zdG9yYWdlXG4gICAgLmZyb20oU1RPUkFHRV9CVUNLRVQpXG4gICAgLnJlbW92ZShbcGF0aF0pO1xuXG4gIGlmIChlcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihgRGVsZXRlIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICB9XG59XG5cbi8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlIHBhdGhcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUZpbGVQYXRoKFxuICBmb2xkZXI6IHN0cmluZywgXG4gIG9yaWdpbmFsTmFtZTogc3RyaW5nLCBcbiAgZXZlbnRJZD86IHN0cmluZ1xuKTogc3RyaW5nIHtcbiAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgY29uc3QgcmFuZG9tU3RyID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpO1xuICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gb3JpZ2luYWxOYW1lLnNwbGl0KCcuJykucG9wKCk7XG4gIGNvbnN0IGZpbGVOYW1lID0gYCR7dGltZXN0YW1wfV8ke3JhbmRvbVN0cn0uJHtmaWxlRXh0ZW5zaW9ufWA7XG4gIFxuICBpZiAoZXZlbnRJZCkge1xuICAgIHJldHVybiBgJHtmb2xkZXJ9LyR7ZXZlbnRJZH0vJHtmaWxlTmFtZX1gO1xuICB9XG4gIFxuICByZXR1cm4gYCR7Zm9sZGVyfS8ke2ZpbGVOYW1lfWA7XG59ICJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsInN1cGFiYXNlQWRtaW4iLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsIlNUT1JBR0VfQlVDS0VUIiwiU1VQQUJBU0VfU1RPUkFHRV9CVUNLRVQiLCJ1cGxvYWRGaWxlIiwiZmlsZSIsInBhdGgiLCJkYXRhIiwiZXJyb3IiLCJzdG9yYWdlIiwiZnJvbSIsInVwbG9hZCIsImNhY2hlQ29udHJvbCIsInVwc2VydCIsIkVycm9yIiwibWVzc2FnZSIsInB1YmxpY1VybERhdGEiLCJnZXRQdWJsaWNVcmwiLCJwdWJsaWNVcmwiLCJkZWxldGVGaWxlIiwicmVtb3ZlIiwiZ2VuZXJhdGVGaWxlUGF0aCIsImZvbGRlciIsIm9yaWdpbmFsTmFtZSIsImV2ZW50SWQiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwicmFuZG9tU3RyIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwiZmlsZUV4dGVuc2lvbiIsInNwbGl0IiwicG9wIiwiZmlsZU5hbWUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/ws","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/isows"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fevents%2F%5Bid%5D%2Froute&page=%2Fapi%2Fevents%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fevents%2F%5Bid%5D%2Froute.ts&appDir=C%3A%5CUsers%5CAdministrator%5Cnana-cursor-admin-dashboard-gallery-feature-enhancement-a647%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAdministrator%5Cnana-cursor-admin-dashboard-gallery-feature-enhancement-a647&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();